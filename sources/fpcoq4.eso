C FPCOQ4    SOURCE    MB234859  16/10/07    21:15:06     9121
      SUBROUTINE FPCOQ4(IPTVPR,IPMAIL,IPTINT,IVAFOR)
*____________________________________________________________________
*
*   CALCULE LES FORCES DE PRESSIONS SUR LES COQUES COQ4 3D
*
*   ENTREES :
*   ---------
*
*    IPTVPR   MELVAL CONTENANT LES PRESSIONS APPLIQUEES
*    IPMAIL   OBJET GEOMETRIQUE
*    IPTINT   POINTEUR SUR UN MINTE CONTENANT LES POINTS D INTEGRATION
*             (SEGMENT ACTIF EN ENTREE ET EN SORTIE)
*    IVAFOR   POINTEUR SUR UN MPTVAL ET DES MELVALS DEVANT CONTENIR
*             LES FORCES NODALES RESULTANTES
*
*      G. M. GIANNUZZI   SETT  86
*      PASSAGE AUX NOUVEAUX CHAMELEM PAR JM CAMPENON LE 12 09 90
*
*____________________________________________________________________
*
      IMPLICIT INTEGER(I-N)
      IMPLICIT REAL*8(A-H,O-Z)
*
-INC SMCHAML
-INC SMELEME
-INC SMINTE
-INC SMCOORD
-INC CCOPTIO
*
      SEGMENT MPTVAL
        INTEGER IPOS(NS)    ,NSOF(NS)
        INTEGER      IVAL(NCOSOU)
        CHARACTER*16 TYVAL(NCOSOU)
      ENDSEGMENT
*
      DIMENSION   XE(3,4),XEL(3,4),BPSS(3,3)
      DIMENSION  SHP(6,4),FTLOC(24),FTGLO(24)
*
      MELVA1=IPTVPR
*
      MINTE=IPTINT
C*    SEGACT MINTE                               <- ACTIF EN E/S
      NBPGAU=POIGAU(/1)
      NBGM1 =NBPGAU-1
*
      MELEME=IPMAIL
*
      NBPTEL=NUM(/1)
      NBELEM=NUM(/2)
*
      SEGACT MCOORD
*
*     BOUCLE SUR LES ELEMENTS
*
      DO 1000 IB=1,NBELEM
         CALL DOXE(XCOOR,IDIM,NBPTEL,NUM,IB,XE)
*
*        MATRICE DE PASSAGE  ET COORDONNEES LOCALES
*
         CALL CQ4LOC(XE,XEL,BPSS,IERR,0)
         CALL TRPOSE(BPSS)
*
*        MISE A 0 DU VECTEUR FORCE
*
         DO 100 I=1,24
 100     FTLOC(I)=0.D0
*
*        INTEGRATION NUMERIQUE : IGAU NUMERO DU POINT DE GAUSS
*                                IA NUMERO D UN NOEUD
*
         IBMN=MIN(IB,MELVA1.VELCHE(/2))
         DO 200 IGAU=1,NBGM1
            IGMN=MIN(IGAU,MELVA1.VELCHE(/1))
            PRE=MELVA1.VELCHE(IGMN,IBMN)
            DO 500 IA  =1,NBPTEL
               SHP(1,IA)=SHPTOT(1,IA,IGAU)
               SHP(2,IA)=SHPTOT(2,IA,IGAU)
               SHP(3,IA)=SHPTOT(3,IA,IGAU)
 500        CONTINUE
            CALL JACOBI(XEL,SHP,2,NBPTEL,DJAC)
*
            DJAC=DJAC*POIGAU(IGAU)*PRE
            DO 550 NP=1,NBPTEL
               IC =(NP-1)*6+3
               FTLOC(IC)=FTLOC(IC)+SHP(1,NP)*DJAC
 550        CONTINUE
 200     CONTINUE
*
*     CHANGEMENT DE REPERE
*
         CALL MATVEC(FTLOC,FTGLO,BPSS,8)
         IE=0
         MPTVAL=IVAFOR
         DO 560 IC=1,4
            DO 560 ID=1,6
               IE=IE+1
               MELVAL=IVAL(ID)
               VELCHE(IC,IB)=FTGLO(IE)
 560     CONTINUE
 1000 CONTINUE
*
*  Segment supprime dans fpcoqu.eso
C*      SEGSUP MELVA1
C*    SEGDES MINTE                               <- ACTIF EN E/S
*
      RETURN
      END



