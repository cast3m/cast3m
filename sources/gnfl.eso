C GNFL      SOURCE    CB215821  16/12/05    21:39:31     9237
      SUBROUTINE GNFL
C_______________________________________________________________________
C
C
C     CH2 = GNFL   MODL1 CH1  ( CAR1 )  ;
C
C      MODL1  MMODEL
C      CH1    MCHAML OU CHPOINT
C      CAR1   MCHAML de caract{ristiques (facultatif)
C      CH2    CHPOINT
C___________________________________________________________________
C
      IMPLICIT INTEGER(I-N)
      IMPLICIT REAL*8(A-H,O-Z)
-INC CCOPTIO
-INC SMCHPOI
*
      IPCHE1=0
      IPCHE2=0
      IPCHE3=0
      IPCHPO=0
*
      CALL LIROBJ('MMODEL',IPMODL,1,IRT1)
      IF (IERR.NE.0) RETURN
*
*   LECTURE D'UN CHPOINT OU D'UN MCHAML
*
      CALL LIROBJ('CHPOINT',IPCHPO,0,IRT1)
      IF (IERR.NE.0) RETURN
      IF (IRT1.EQ.0) THEN
        CALL LIROBJ('MCHAML',IPIN,1,IRT1)
        IF (IERR.NE.0) RETURN
        CALL REDUAF(IPIN,IPMODL,IPCHE1,0,IR,KER)
        IF(IR   .NE. 1) CALL ERREUR(KER)
        IF(IERR .NE. 0) RETURN
      ENDIF
C
C      2 EME CHAMP  (FACULTATIF)
C
      CALL LIROBJ('MCHAML',IPIN,0,IRT1)
      IF (IERR.NE.0) RETURN
      IPCHE2=0
      IF (IRT1.EQ.1) THEN
        CALL REDUAF(IPIN,IPMODL,IPCHE2,0,IR,KER)
        IF(IR   .NE. 1) CALL ERREUR(KER)
        IF(IERR .NE. 0) RETURN
      ENDIF
C
      CALL GNFLP(IPMODL,IPCHE1,IPCHPO,IPCHE2,IPCHE3,IRET)
      IF(IERR .NE. 0) RETURN
C
      IF (IRET.EQ.1) THEN
C
C       ATTRIBUTION D'UNE NATURE DISCRETE AU CHPO QUI SORT
C
        MCHPOI = IPCHE3
        SEGACT MCHPOI*MOD
        JATTRI(1) = 2
        SEGDES MCHPOI
C
        CALL ECROBJ('CHPOINT',IPCHE3)
      ENDIF
C
      RETURN
      END


