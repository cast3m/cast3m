C VRACOR    SOURCE    CHAT      11/03/16    21:33:34     6902
      SUBROUTINE VRACOR(IPMODE,IPLIQU,IFLAG,ICARA)
**************************************************************
*  CALUL DES VECTEURS DIRIGES VERS L'EXTERIEUR DU FLUIDE POUR
*  LES ELEMENTS RACCORDS FLUIDE-MECANIQUE ,ET LES AJOUTER DANS
*  LE CHAMP/ELEMENT DE CARACTERISTIQUES
*
*  ENTREES :
*
*   IPMODE = POINTEUR SUR UN OBJET MMODEL
*   IPLIQU =POINTUER SUR LE MAILLAGE  LIQUIDE
*   ICARA = POINTEUR SUR LE CHAMP/ELEMENT DE CARACTERISTIQUES
*   IFLAG = 1 LE CHAMELEM DE CARACTERISTIQUES EXITE =2 IL N'EXISTE PAS
*   SORTIES :
*
*    ICARA  =POINTEUR SUR LE CHAMP/ELEMENT DE CARACTERISTIQUES
*            COMPLETE
****************************************************************
      IMPLICIT INTEGER(I-N)
      IMPLICIT REAL*8(A-H,O-Z)
*
-INC CCOPTIO
-INC SMCHAML
-INC SMMODEL
*
      SEGMENT MPTVAL
        INTEGER IPOS(NS),NSOF(NS)
        INTEGER IVAL(NCOSOU)
        CHARACTER*16 TYVAL(NCOSOU)
      ENDSEGMENT
*
      SEGMENT INFO
        INTEGER INFELL(JG)
      ENDSEGMENT
*
       CHARACTER*4 V(3)
       DATA V/'VX  ','VY  ','VZ  '/
*
       MMODEL=IPMODE
*
*    ACTIVATION DU MCHAML
*
      NSOUS=KMODEL(/1)
      IF(IFLAG.NE.2)THEN
        MCHELM=ICARA
        SEGACT MCHELM
      ELSE
        N1=NSOUS
        L1=16
        N3=6
        SEGINI MCHELM
        ICARA=MCHELM
        TITCHE='CARACTERISTIQUES'
        IFOCHE=IFOUR
      ENDIF
*
*    BOUCLE SUR LES SOUS-ZONES
*
      DO   500 ISOUS=1,NSOUS
        NCOMP=0
        IMODEL=KMODEL(ISOUS)
        IPMAIL=IMAMOD
        CALL VRACO1(IPMAIL,IPLIQU,IMELVA)
        IF(IERR.NE.0)THEN
            IF(IFLAG.NE.2)THEN
              SEGSUP MCHELM
            ELSE
              SEGDES MCHELM
            ENDIF
            RETURN
        ENDIF
        IF(IFLAG.NE.2)THEN
          MCHAML=ICHAML(ISOUS)
          SEGACT MCHAML
          NCOMP=IELVAL(/1)
          N2=NCOMP+IDIM
          SEGADJ MCHAML
        ELSE
         N2=IDIM
         MELE=NEFMOD
         if(infmod(/1).lt.5) then
         CALL ELQUOI(MELE,0,3,IPINF,IMODEL)
         IF (IERR.NE.0)THEN
            IF(IFLAG.NE.2)THEN
              SEGSUP MCHELM
            ELSE
              SEGDES MCHELM
            ENDIF
            RETURN
         ENDIF
         INFO=IPINF
         IPMIN=INFELL(11)
         segsup info
         else
         IPMIN=INFMOD(5)
         endif
         IMACHE(ISOUS)=IPMAIL
         CONCHE(ISOUS)=CONMOD
         INFCHE(ISOUS,1) = 0
         INFCHE(ISOUS,2) = 0
         INFCHE(ISOUS,3) = NIFOUR
         INFCHE(ISOUS,4) = IPMIN
         INFCHE(ISOUS,5) = 0
         INFCHE(ISOUS,6) = 3
         SEGINI MCHAML
         ICHAML(ISOUS)=MCHAML
        ENDIF
        MPTVAL=IMELVA
        SEGACT MPTVAL
        DO 10 IC=1,IDIM
          IELVAL(NCOMP+IC)=IVAL(IC)
          NOMCHE(NCOMP+IC)=V(IC)
          TYPCHE(NCOMP+IC)=TYVAL(IC)
 10    CONTINUE
       SEGSUP MPTVAL
       SEGDES MCHAML
 500   CONTINUE
       SEGDES,MCHELM
       RETURN
       END











