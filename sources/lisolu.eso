C LISOLU    SOURCE    CHAT      05/01/13    01:22:25     5004
      SUBROUTINE LISOLU(MSOLUT,IRETOU,IFORM)
      IMPLICIT INTEGER(I-N)
      IMPLICIT REAL*8(A-H,O-Z)
C=======================================================================
C CE SUBROUTINE  LIT  SUR LE FICHIER IORES UN OBJET MSOLUT
C      APPELE PAR WRPIL
C      APPELLE : SOPAPF ECDIFE  ECDIFR
C      ECRIT PAR FARVACQUE - REPRIS PAR LENA
C=======================================================================
C
       DIMENSION ILENA(10)
       DIMENSION ITABM1(2)
-INC CCOPTIO
-INC SMSOLUT
C
C
      IRETOU=0
      ILENA(1)=0
      ILENA(2)=0
      ILENA(3)=0
      MSOLUT =0

      NTOTO=2
      CALL LFCDIE  (IORES,NTOTO,ILENA,IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998

      NIPO =ILENA(1)
cmb-vieux-et-faux      IF (NIPO.EQ.0) GO TO  99
      SEGINI MSOLUT
      IF(NIPO.GE.3) MSOLIS(3)=ILENA(2)

      NTOTO=2
      CALL LFCDIM  (IORES,NTOTO,ITABM1,IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998
      WRITE(ITYSOL,FMT='(2A4)') ITABM1(1),ITABM1(2)

C ... Si NIPO==0 il n'y avait que le ITYSOL de sauvé ...
      IF (NIPO.EQ.0) GO TO  99

C MODI 19 DEC 1 CARTE
C     CALL LFCDIE  (IORES,NIPO,MSOLIS,IRETOU,IFORM)
      CALL LFCDEE  (IORES,NIPO,MSOLIS(1),IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998

      CALL LFCDIE  (IORES,NIPO,MSOLIT,IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998

C  ON PREND LES MSOLIS UN PAR UN
      MSOLRE = MSOLIS(1)
      IF (MSOLRE.EQ.0) GO TO 11
      NTOTO=1
      CALL LFCDIE  (IORES,NTOTO,ILENA,IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998
      N=ILENA(1)
      SEGINI MSOLRE
      CALL LFCDI2 (IORES,N,SOLRE(1),IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998
      SEGDES MSOLRE
      MSOLIS(1)=MSOLRE
   11 CONTINUE
C  LISTE DES PAS------------------------------
      MSOLEN=MSOLIS(2)
      IF (MSOLEN.EQ.0) GO TO 12
      NTOTO=1
      CALL LFCDIE  (IORES,NTOTO,ILENA,IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998
      N=ILENA(1)
      SEGINI MSOLEN
C MODI 19 DEC 1 CARTE
C     CALL LFCDIE  (IORES,N,ISOLEN,IRETOU,IFORM)
      CALL LFCDEE  (IORES,N,ISOLEN(1),IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998
      SEGDES MSOLEN
      MSOLIS(2)=MSOLEN
C  LISTE DE MMODE-----------------------------
   12 CONTINUE
      MSOLEN=MSOLIS(4)
      IF (MSOLEN.EQ.0) GO TO 13
      NTOTO=1
      ILENA(1)=N
      CALL LFCDIE  (IORES,NTOTO,ILENA,IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998
      N=ILENA(1)
      SEGINI MSOLEN
      MSOLIS(4)=MSOLEN
      DO 20 IPAS =1,N
      ILENA(1)=0
      ILENA(2)=0
      ILENA(3)=0
      MMODE=0
      NTOTO=3
      CALL LFCDIE  (IORES,NTOTO,ILENA,IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998
      NIPAS= ILENA(1)
      IF (NIPAS.NE.IPAS) GO TO 998
      ISOMME = ILENA(2)+ILENA(3)
C     TEST SI MMODE EXISTE-----------
      IF (ISOMME.EQ.0) GO TO 21
      LVALM=ILENA(2)
      NIMOD=ILENA(3)
      SEGINI MMODE
      NTOTO=3
      CALL LFCDI2  (IORES,LVALM,FMMODD,IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998
      CALL LFCDIE  (IORES,NIMOD,IMMODD,IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998
      SEGDES MMODE
   21 CONTINUE
      ISOLEN(IPAS)=MMODE
   20 CONTINUE
      SEGDES MSOLEN
   13 CONTINUE

C     ON VA RELIRE      LESPOINTEURS---------------
      DO 18 II=5,NIPO
      MSOLEN=MSOLIS(II)
      IF(MSOLEN.EQ.0) GOTO 18
      NTOTO=1
      CALL LFCDIE  (IORES,NTOTO,ILENA,IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998
      N=ILENA(1)
      SEGINI MSOLEN
      CALL LFCDIE  (IORES,N,ISOLEN,IRETOU,IFORM)
      IF (IRETOU.NE.0)GO TO 998
      SEGDES MSOLEN
      MSOLIS(II)=MSOLEN
  18  CONTINUE
 998  CONTINUE
  99  RETURN
      END


