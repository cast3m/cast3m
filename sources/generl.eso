C GENERL    SOURCE    PV        07/11/23    21:17:05     5978
C  EST APPELE PAR GENERATRICE
C
      SUBROUTINE GENERL(LP1,LP2,IPT1,MELEME,IDS)
C       IDS COULEUR
C       IPT1 LIGNE CONNU
C       MELEME LIGNE A FABRIQUER
      IMPLICIT INTEGER(I-N)
      IMPLICIT REAL*8 (a-h,o-z)
-INC SMELEME
-INC SMCOORD
-INC CCOPTIO
      NBNN=IPT1.NUM(/1)
      NBELEM=IPT1.NUM(/2)
      NBSOUS=0
      NBREF=0
      SEGINI MELEME
      ITYPEL=IPT1.ITYPEL
      NUM(1,1)=LP1
      NUM(NBNN,NBELEM)=LP2
      IREFPI=(IPT1.NUM(1,1)-1)*(IDIM+1)
      XPI=XCOOR(IREFPI+1)
      YPI=XCOOR(IREFPI+2)
      ZPI=XCOOR(IREFPI+3)
      IREFP1=(LP1-1)*(IDIM+1)
      XP1=XCOOR(IREFP1+1)
      YP1=XCOOR(IREFP1+2)
      ZP1=XCOOR(IREFP1+3)
      NBPTA=XCOOR(/1)/(IDIM+1)
      NBPTS=NBPTA+NBELEM*(NBNN-1)
      SEGADJ MCOORD
      DO 10 J=1,NBELEM
      ICOLOR(J)=IDS
      DO 11 I=2,NBNN
      IF (I.EQ.NBNN.AND.J.EQ.NBELEM) GOTO 11
      IREFPC=(IPT1.NUM(I,J)-1)*(IDIM+1)
      XPC=XCOOR(IREFPC+1)
      YPC=XCOOR(IREFPC+2)
      ZPC=XCOOR(IREFPC+3)
      TPC=XCOOR(IREFPC+IDIM+1)
      XCOOR(NBPTA*(IDIM+1)+1)=XPC-XPI+XP1
      XCOOR(NBPTA*(IDIM+1)+2)=YPC-YPI+YP1
      IF (IDIM.EQ.3) XCOOR(NBPTA*(IDIM+1)+3)=ZPC-ZPI+ZP1
      XCOOR((NBPTA+1)*(IDIM+1))=TPC
      NBPTA=NBPTA+1
      NUM(I,J)=NBPTA
  11  CONTINUE
      IF (J.EQ.1) GOTO 10
      IF (IPT1.NUM(1,J).NE.IPT1.NUM(NBNN,J-1)) THEN
       NBPTS=NBPTA
       SEGADJ MCOORD
       CALL ERREUR(24)
       RETURN
      ENDIF
        NUM(1,J)=NUM(NBNN,J-1)
  10  CONTINUE
       NBPTS=NBPTA
       SEGADJ MCOORD
      RETURN
      END


