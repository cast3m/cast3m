C CCOTRA    SOURCE    CB215821  18/12/04    21:15:10     10020
      SUBROUTINE CCOTRA(WRK52,WRK2,NCOURB,WRK53)
C COTRAC    SOURCE    AM        97/12/23    21:41:23     3015
c      SUBROUTINE COTRAC(WRK0,WRK2,NCOURB,KERRE)
      IMPLICIT INTEGER(I-N)
      IMPLICIT REAL*8(A-H,O-Z)
-INC SMEVOLL
-INC SMLREEL
-INC DECHE
-INC CCREEL
-INC CCOPTIO
      SEGMENT/WRK2/(TRAC(LTRAC)*D)
      DATA NCOMAX/130/
      KERRE=0
      MEVOLL=nint(XMAT(5))

      SEGACT MEVOLL
      KEVOLL=IEVOLL(1)
      SEGACT KEVOLL
      MLREEL=IPROGX
      MLREE1=IPROGY

      SEGACT MLREEL,MLREE1
      NBPOIX=PROG(/1)
      NBPOIY=MLREE1.PROG(/1)
      IF(NBPOIX.GT.NCOMAX+1) KERRE=31
      IF(NBPOIX.LT.3)        KERRE=32
      IF(KERRE.NE.0) RETURN
C
C   TESTS SUR LES POINTS DE LA COURBE   ( A COMPLETER )
C
      YUNG=XMAT(1)
      IF(YUNG .LE. 0.D0) THEN
        REAERR(1)=YUNG
        CALL ERREUR(1090)
        KERRE=34
        RETURN
      ENDIF
      PSIG=MLREE1.PROG(1)
      PEPS=PROG(1)
      IF(PSIG.NE.0.D0 .OR. PEPS.NE.0.D0) THEN
        REAERR(1)=PEPS
        REAERR(2)=PSIG
        CALL ERREUR(1092)
        KERRE=35
        RETURN
      ENDIF
C
C  VERIF DE LA LIMITE ELASTIQUE NON NULLE
C
      PSIG =MLREE1.PROG(2)
      IF(PSIG.EQ.0.D0) THEN
        REAERR(1)=PSIG
        CALL ERREUR(1091)
        KERRE=30
        RETURN
      ENDIF
      PEPS=PROG(2)
      IF(PEPS.EQ.0.D0) THEN
        REAERR(1)=PEPS
        CALL ERREUR(1089)
        KERRE=35
        RETURN
      ENDIF
      PENTE=PSIG/PEPS
      RA=ABS(PENTE-YUNG)/YUNG
      IF(RA.GT.1.D-3) THEN
        REAERR(1)=PENTE
        REAERR(2)=YUNG
        CALL ERREUR(1088)
        KERRE=36
        RETURN
      ENDIF
C
C  VERIF DE LA PENTE
C
      DO 100 I=3,NBPOIX
        I1=I-1
        DEPS=PROG(I)-PROG(I1)
        IF(DEPS.LE.0.D0) THEN
          CALL ERREUR(1087)
          KERRE=33
          RETURN
        ENDIF
        PENTE=(MLREE1.PROG(I)-MLREE1.PROG(I1))/DEPS
        IF(PENTE.GT.1.01*YUNG) THEN
          REAERR(1)=PENTE
          REAERR(2)=YUNG
          CALL ERREUR(1088)
          KERRE=33
          RETURN
        ENDIF
 100  CONTINUE
      NCOURB=1
      TRAC(1)=MLREE1.PROG(2)
      TRAC(2)=0.D0
      DO 695 I=3,NBPOIX
        PEPS=PROG(I)
        PSIG=MLREE1.PROG(I)
        NCOURB=NCOURB+1
        TRAC(2*NCOURB-1)=PSIG
        TRAC(2*NCOURB)=PEPS-PSIG/YUNG
  695 CONTINUE

      END

