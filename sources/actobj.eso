C ACTOBJ    SOURCE    CB215821  19/03/18    21:15:01     10160
      SUBROUTINE ACTOBJ(CTYPE,IPOIN,IKOD)

C____________________________________________________________________
C
C  OBJET :  Cette SUBROUTINE permet d''activer un OBJET Cast3M
C
C  ENTREES :
C  °°°°°°°°°
C
C     CTYPE   Type d'objet a activer
C     IPOIN   Pointeur sur l'objet a activer
C     IKOD    ENTIER valant 0 pour SEGDES
C                           1 pour SEGACT de l'objet
C
C  SORTIE :
C  °°°°°°°°
C     R.A.S l'objet et son contenu sont actives
C_____________________________________________________________________
C
      IMPLICIT INTEGER(I-N)
      IMPLICIT REAL*8(A-H,O-Z)
*
-INC CCOPTIO
-INC SMCHAML
-INC SMINTE
-INC SMCHPOI
-INC SMMODEL
-INC SMEVOLL
-INC SMELEME
-INC SMNUAGE

      SEGMENT JPOINT(0)
      SEGMENT IPOINT(0)
      SEGMENT ISEG(0)
      PARAMETER(NBTYP=9)
      CHARACTER*(*)CTYPE
      CHARACTER*8  CTYP1,DTAOBJ(NBTYP)
      CHARACTER*16 MOT16

      LOGICAL BCODE,BSEG

      DATA DTAOBJ/'MCHAML  ','CHPOINT ','MMODEL  ','MAILLAGE',
     &            'EVOLUTIO','LISTMOTS','LISTREEL','LISTENTI',
     &            'NUAGE   ' /

      CTYP1 = CTYPE
      IPOI1 = IPOIN
      BCODE = IKOD .EQ. 0
      IOBJ  = 0
      IPOINT= 0
      JPOINT= 0
      BSEG  =.FALSE.

      CALL PLAMO8(DTAOBJ,NBTYP,IPLAC,CTYP1)
      IF(IERR.NE.0) RETURN
      IF(IPLAC.EQ.0)RETURN

      IF (IPOI1 .EQ. 0) THEN
C        PRINT *,'     ECROBJ : TYPE ',CTYP1,'POINTEUR ',IPOI1
C        CALL ERREUR(21)
        RETURN
      ENDIF

C     Verification de l'etat du SEGMENT IPOIN
C      CALL OOOETA(IPOIN,IETA,IMOD)
C     Il est   actif en *NOMOD et on veut SEGACT ==> RETURN
C      IF(IETA.EQ.1 .AND. IMOD.EQ.0 .AND. .NOT. BCODE) RETURN

C     Il est inactif et on veut SEGDES ==> RETURN
C      IF(IETA.NE.1 .AND. IMOD.EQ.0 .AND.       BCODE) RETURN

C     Cas potentiels non souhaites
C     Il est   actif en *MOD et on veut SEGACT ==> Il manque un SEGACT*NOMOD quelque part
C      IF(IETA.EQ.1 .AND. IMOD.EQ.1 .AND.       BCODE) THEN
C        ith=0
C        call ooonth(ith)
C        PRINT *,'ACTOBJ : SEGMENT ACTIF en *MOD :',CTYP1,':',ith,IPOIN
C        CALL TRBAC
C      ENDIF

C     Prise de verrouillage
      CALL VERROU(2)

 1    CONTINUE
      IF(IPLAC.EQ.0) THEN
C        PRINT *,'OBJMOD.ESO :',CTYP1,' NON TRAITE ENCORE'
        GOTO 9999
      ENDIF

      GOTO (100,200,300,400,500,600,600,600,700),IPLAC
      GOTO 9999

 100  CONTINUE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     OBJET DE TYPE MCHAML
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
        MCHEL1=IPOI1
        MELSAV=0
        SEGACT,MCHEL1
        DO 110 II=1,MCHEL1.ICHAML(/1)
          MCHAM1=MCHEL1.ICHAML(II)
          MINTE =MCHEL1.INFCHE(II,4)
          IPT1=MCHEL1.IMACHE(II)
          IF (BCODE) THEN
            SEGDES,IPT1
            IF(MINTE .NE. 0) SEGDES,MINTE
          ELSE
            SEGACT,IPT1
            IF(MINTE .NE. 0) SEGACT,MINTE
          ENDIF

          SEGACT,MCHAM1
          DO 120 JJ=1,MCHAM1.IELVAL(/1)
            MOT16 =MCHAM1.TYPCHE(JJ)
            MELVA1=MCHAM1.IELVAL(JJ)
            IF(MELVA1 .EQ. MELSAV) GOTO 120
            MELSAV=MELVA1
            SEGACT,MELVA1
            IF    (MOT16(1:12) .EQ. 'POINTEURLIST')THEN
              IPOI2 = 0
              DO 130 KK=1,MELVA1.IELCHE(/2)
                DO 140 LL=1,MELVA1.IELCHE(/1)
                  ISEG=MELVA1.IELCHE(LL,KK)
                  IF(ISEG .NE. IPOI2 .AND. ISEG.NE.0)THEN
                    IPOI2 = ISEG
                    IF (BCODE) THEN
                      SEGDES,ISEG
                    ELSE
                      SEGACT,ISEG
                    ENDIF
                  ENDIF
 140            CONTINUE
 130          CONTINUE
            ELSEIF(MOT16(1:16) .EQ. 'POINTEUREVOLUTIO')THEN
              IPOI2 = 0
              DO 150 KK=1,MELVA1.IELCHE(/2)
                DO 160 LL=1,MELVA1.IELCHE(/1)
                  MEVOL1=MELVA1.IELCHE(LL,KK)
                  IF(MEVOL1 .NE. IPOI2 .AND. MEVOL1.NE.0)THEN
                    IPOI2 = MEVOL1
                    SEGACT,MEVOL1
                    DO 170 MM=1,MEVOL1.IEVOLL(/1)
                      KEVOL1=MEVOL1.IEVOLL(MM)
                      SEGACT,KEVOL1
                      ISEG=KEVOL1.IPROGX
                      IF (BCODE) THEN
                        SEGDES,ISEG
                      ELSE
                        SEGACT,ISEG
                      ENDIF
                      ISEG=KEVOL1.IPROGY
                      IF (BCODE) THEN
                        SEGDES,ISEG
                      ELSE
                        SEGACT,ISEG
                      ENDIF
                      IF (BCODE) SEGDES,KEVOL1
 170                  CONTINUE
                    IF (BCODE) SEGDES,MEVOL1
                  ENDIF
 160            CONTINUE
 150          CONTINUE
            ELSEIF(MOT16(1:8) .EQ. 'POINTEUR')THEN
              IF(.NOT. BSEG)THEN
                SEGINI,JPOINT,IPOINT
                BSEG=.TRUE.
              ENDIF
              CTYP1=MOT16(9:16)
              CALL PLAMO8(DTAOBJ,NBTYP,IPLAC,CTYP1)
              IF(IPLAC .NE. 0)THEN
                DO 180 KK=1,MELVA1.IELCHE(/2)
                  DO 190 LL=1,MELVA1.IELCHE(/1)
                    IPOI2=MELVA1.IELCHE(LL,KK)
                    IF(IPOI2 .NE. 0)THEN
                      JPOINT(**)= IPOI2
                      IPOINT(**)= IPLAC
                    ENDIF
 190              CONTINUE
 180            CONTINUE
              ENDIF
            ENDIF
            IF (BCODE) SEGDES,MELVA1
 120       CONTINUE
           IF (BCODE) SEGDES,MCHAM1
 110     CONTINUE
         IF (BCODE) SEGDES,MCHEL1
      GOTO 9999

 200  CONTINUE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     OBJET DE TYPE CHPOINT
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      MCHPO1=IPOI1
      SEGACT,MCHPO1
      DO 210 II=1,MCHPO1.IPCHP(/1)
        MSOUP1=MCHPO1.IPCHP(II)
        SEGACT,MSOUP1
        IPT1=MSOUP1.IGEOC
        IF (BCODE) THEN
          SEGDES,IPT1
        ELSE
          SEGACT,IPT1
        ENDIF

        MPOVA1=MSOUP1.IPOVAL
        IF (BCODE) THEN
          SEGDES,MPOVA1
        ELSE
          SEGACT,MPOVA1
        ENDIF
        IF (BCODE) SEGDES,MSOUP1
 210  CONTINUE
      IF (BCODE) SEGDES,MCHPO1
      GOTO 9999

 300  CONTINUE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     OBJET DE TYPE MMODEL
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      MMODE1=IPOI1
      SEGACT,MMODE1
      DO 310 II=1,MMODE1.KMODEL(/1)
        IMODE1=MMODE1.KMODEL(II)
        SEGACT,IMODE1
        IPT1=IMODE1.IMAMOD
        IF (BCODE) THEN
          SEGDES,IPT1
        ELSE
          SEGACT,IPT1
        ENDIF

        DO 320 JJ=1,IMODE1.IVAMOD(/1)
          CTYP1=IMODE1.TYMODE(JJ)
          CALL PLAMO8(DTAOBJ,NBTYP,IPLAC,CTYP1)
          IF(IPLAC .NE. 0)THEN
            IF(.NOT. BSEG)THEN
              SEGINI,JPOINT,IPOINT
              BSEG=.TRUE.
            ENDIF
            JPOINT(**)=IMODE1.IVAMOD(JJ)
            IPOINT(**)=IPLAC
          ENDIF
 320    CONTINUE

        DO 330 JJ=1,IMODE1.LNOMID(/1)
          NOMID=IMODE1.LNOMID(JJ)
          IF(NOMID .NE. 0)THEN
            IF (BCODE) THEN
              SEGDES,NOMID
            ELSE
              SEGACT,NOMID
            ENDIF
          ENDIF
 330    CONTINUE
        IF (BCODE) SEGDES,IMODE1
 310  CONTINUE
      IF (BCODE) SEGDES,MMODE1
      GOTO 9999

 400  CONTINUE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     OBJET DE TYPE MAILLAGE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      IPT1=IPOI1
      SEGACT,IPT1
      DO 410 II=1,IPT1.LISOUS(/1)
        IPT2 =IPT1.LISOUS(II)
        IF (BCODE) THEN
          SEGDES,IPT2
        ELSE
          SEGACT,IPT2
        ENDIF
 410  CONTINUE
      IF (BCODE) SEGDES,IPT1
      GOTO 9999

 500  CONTINUE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     OBJET DE TYPE EVOLUTIO
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      MEVOL1=IPOI1
      SEGACT,MEVOL1
      DO 510 II=1,MEVOL1.IEVOLL(/1)
        KEVOL1=MEVOL1.IEVOLL(II)
        SEGACT,KEVOL1
        ISEG=KEVOL1.IPROGX
        IF (BCODE) THEN
          SEGDES,ISEG
        ELSE
          SEGACT,ISEG
        ENDIF
        ISEG=KEVOL1.IPROGY
        IF (BCODE) THEN
          SEGDES,ISEG
        ELSE
          SEGACT,ISEG
        ENDIF
        IF (BCODE) SEGDES,KEVOL1
 510  CONTINUE
      IF (BCODE) SEGDES,MEVOL1
      GOTO 9999

 600  CONTINUE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     OBJET DE TYPE LISTXXXX
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      ISEG=IPOI1
      IF (BCODE) THEN
        SEGDES,ISEG
      ELSE
        SEGACT,ISEG
      ENDIF
      GOTO 9999

 700  CONTINUE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     OBJET DE TYPE NUAGE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      MNUAG1=IPOI1
      SEGACT,MNUAG1
      DO 710 II=1,MNUAG1.NUAPOI(/1)
        CTYP1=MNUAG1.NUATYP(II)
        CALL PLAMO8(DTAOBJ,NBTYP,IPLAC,CTYP1)
        IF(IPLAC .NE. 0)THEN
          IF(.NOT. BSEG)THEN
            SEGINI,JPOINT,IPOINT
            BSEG=.TRUE.
          ENDIF
          NUAVIN=MNUAG1.NUAPOI(II)
          SEGACT,NUAVIN
          DO 720 JJ=1,NUAVIN.NUAINT(/1)
            JPOINT(**)=NUAVIN.NUAINT(JJ)
            IPOINT(**)=IPLAC
 720      CONTINUE
          IF (BCODE) SEGDES,NUAVIN
        ENDIF
 710  CONTINUE
      IF (BCODE) SEGDES,MNUAG1
C      GOTO 9999

 9999 CONTINUE
      IF (.NOT. BSEG) GOTO 9990
      IF(IOBJ .NE. JPOINT(/1))THEN
        IOBJ  = IOBJ + 1
        IPLAC = IPOINT(IOBJ)
        IPOI1 = JPOINT(IOBJ)
        IF (IERR .NE. 0) GOTO 9990
        GOTO 1
      ENDIF

 9990 CONTINUE

C     Liberation du verrouillage
      IF (BSEG) SEGSUP,JPOINT,IPOINT
      CALL VERROU(3)

      END

