C NTAP13    SOURCE    CHAT      05/01/13    02:02:00     5004
      SUBROUTINE NTAP13 (MP,MCP,MCQ,M,N,MVDU,MVDL,KK,II)
      IMPLICIT INTEGER(I-N)
      IMPLICIT REAL*8(A-H,O-Z)
*
*   MISE A JOUR DE LA MATRICE DE PROJECTION
*
-INC TMXMAT
-INC SMLREEL
-INC CCOPTIO
      MXMAT=MCP
      MXMA1=MCQ
      MXMA2=MVDU
      MXMA3=MVDL
      JG=M
      SEGINI MLREEL
      DO 1 J=1,M
      IF(XMAT(J,II).EQ.0.D0) THEN
       PROG(J)=MXMA1.XMAT(J,II)*MXMA2.XMAT(II,KK)*MXMA2.XMAT(II,KK-1)
      ELSE
           PROG(J)=XMAT(J,II)*MXMA3.XMAT(II,KK)*MXMA3.XMAT(II,KK-1)
      ENDIF
    1 CONTINUE
      SEGINI MLREE1
      MXMAT=MP
      CALL MATVE1( XMAT,PROG,M,M,MLREE1.PROG,2)
      LDIM1=M
      LDIM2=M
      SEGINI MXMAT
      XX=0.D0
      DO 2 I=1,M
      XX = MLREE1.PROG(I)*MLREE1.PROG(I) + XX
    2 CONTINUE
      CALL XITY(MLREE1.PROG,MLREE1.PROG,M,XMAT)
      XX=1./XX
      CALL REEMAT(XX,XMAT,M,M)
      MXMA1=MP
      CALL ADDIMA(MXMA1.XMAT,XMAT,M,M,2)
      MP=MXMA1
      SEGSUP MLREEL,MLREE1
      RETURN
      END

