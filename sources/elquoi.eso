C ELQUOI    SOURCE    KICH      18/10/04    21:15:20     9946

C=======================================================================
C=                  Sous-programme ELQUOI                              =
C=                  ---------------------                              =
C=                                                                     =
C= Ce sous programme fournit les caracteristiques des elements finis.  =
C=                                                                     =
C= Entrees :                                                           =
C= ---------                                                           =
C=   NELE      : numero de l'element fini                              =
C=   NBPOIN    : nombre de points d'integration contraintes            =
C=               multicouches ( COQ6 - COQ8 )                          =
C=   INTTYP    : type d'integration utilisee par l'operateur           =
C=   Si l'on desire un segment d'integration pour un champ aux :       =
C=     1 = NOEUDS  ( appel a RENOEU )                                  =
C=     2 = points de GAUSS pour centre de GRAVITE et CHAMP CONSTANT    =
C=     3 = points de GAUSS pour la RIGIDITE                            =
C=     4 = points de GAUSS pour la MASSE                               =
C=     5 = points de GAUSS pour les CONTRAINTES                        =
C=     6 = on ne calcule pas de segment d'integration                  =
C=     7 = FACE                                                        =
C=     8 = CENTREP1                                                    =
C=     9 = MSOMMET                                                     =
C     -10= en mecanique on veut calculer les 5 premiers et on les met  =
C          dans infmod(3 ...)                                          =
C=   Dans un autre cas, infell(11) renverra un pointeur sur un segment =
C=   d'integration de type RIGIDITE.                                   =
C=   IMODEL    : pointeur sur une zone elementaire d'un modele         =
C=               SEGMENT ACTIF en entree et en sortie                  =
C= Sorties :                                                           =
C= ---------                                                           =
C=   retourne IPTR pointeur sur un segment INFO ACTIF contenant :      =
C=     La dimension de infell est fixee par NINFOS                     =
C=     infell( 1)  numero de l'element fini                            =
C=     infell( 2)  nombre de points d'integration en contraintes       =
C=                 multicouche                                         =
C=     infell( 3)  nombre de points d'integration pour la masse        =
C=     infell( 4)  nombre de points d'integration pour SIGMA           =
C=                 BSIGMA et KSIGMA                                    =
C=     infell( 5)  nombre de caracteristiques                          =
C=     infell( 6)  nombre de points d'integration pour la RIGIDITE     =
C=     infell( 7)  longueur d'un tableau de travail pour l'element     =
C=     infell( 8)  nombre de fonctions de forme                        =
C=     infell( 9)  nbre de d.d.l. dans la matrice de RIGIDITE          =
C=     infell(10)  taille de la matrice de Hooke                       =
C=     infell(11)  pointeur sur le segment d'integration               =
C=     infell(12)  pointeur sur le 2nd segment d'integration des       =
C=                 elements homogeneises ou fluides (COQ6 ou COQ8)     =
C=     infell(13)  numero de la formulation de l'element fini          =
C=                 = 1       MASSIF                                    =
C=  voir aussi     = 3       COQUE                                     =
C=  NUMMFR.eso     = 5       COQUE EPAISSE ( COQ6 , COQ8 )             =
C=                 = 7       POUTRE                                    =
C=                 = 9       COQUE AVEC CISAILLEMENT TRANSVERSE        =
C=                 = 11      LIQUIDE                                   =
C=                 = 13      TUYAU                                     =
C=                 = 15      LINESPRING                                =
C=                 = 17      TUYAU FISSURE                             =
C=                 = 19      RACCORD MASSIF                            =
C=                 = 21      RACCORD COQUE                             =
C=                 = 23      SURFACE LIBRE                             =
C=                 = 25      MEMBRANE                                  =
C=                 = 26      point support MODAL                       =
C=                 = 27      UNIAXIALE                                 =
C=                 = 28      point support STATIQUE                    =
C=                 = 29      THERMIQUE                                 =
C=                 = 31      INCOMPRESSIBLES                           =
C=                 = 33      POREUX                                    =
C=                 = 35      JOINT                                     =
C=                 = 37      HOMOGENEISE                               =
C=                 = 39      TUYO                                      =
C=                 = 41      TUYAU ACOUSTIQUE PURE                     =
C=                 = 43      RACCORD TUYAU FLUIDE                      =
C=                 = 45      HYBRIDE                                   =
C=                 = 47      FIBRE                                     =
C=                 = 49      BARRE 3D EXCENTREE                        =
C=                 = 51      LIASON A 2 NOEUDS                         =
C=                 = 53      JOINT CISAILLEMENT (2D)                   =
C=                 = 55      JOINT GENERALISE                          =
C=                 = 57      POREUX TYPE Q                             =
C=                 = 59      POREUX TYPE R                             =
C=                 = 61      MACRO ELEMENT                             =
C=                 = 63      XFEM meca rupt (2D/3D)                    =
C=                 = 65      THERMOHYDRIQUE                            =
C=                 = 69      MAGNETODYNAMIQUE                          =
C=                 = 71      ELECTROSTATIQUE                           =
C=                 = 73      DIFFUSION                                 =
C=                 = 75      JOINT UNIDIMENSIONNEL                     =
C=                 = 77      ZONE COHESIVE                             =
c                  = 79      TUYAU 1D pour advection
C*                 = 78      COAXIAL
c cccccc
C=     infell(14)  numero de l'element geometrique associe (NUMGEO)    =
C=     infell(15)  nombre maximal de d.d.l. par noeud                  =
C=     infell(16)  nombre de composantes de contraintes ou de deform.  =
C=======================================================================

      SUBROUTINE ELQUOI(NELE,NBPOIN,INTTYP,IPTR,IPMODL)

      IMPLICIT INTEGER(I-N)
      IMPLICIT REAL*8(A-H,O-Z)

-INC CCOPTIO
-INC CCGEOME
-INC CCHAMP

-INC SMMODEL
-INC SMELEME
-INC SMLMOTS

C  Segment (type LISTENTI) contenant les informations sur un element
      SEGMENT INFO
        INTEGER INFELL(JG)
      ENDSEGMENT

C=======================================================================
C= INTEGR : SAVE local des pointeurs sur les segments d'integration    =
C=          CAS GENERAL                                                =
C= NELFI  : Nombre de types d'element FINI (= LNOMTP de bdata.eso)     =
C= NBMODE : Nombre de MODEs de calcul (= nb valeurs possibles IFOMOD)  =
C= TYINTE : Type de l'INTEGRATION utilise par le calcul                =
C=          (correspond a la valeur de INTTYP=infell(11) en entree)    =
C= NTYNTE : Nombre de TYPEs de segment D'INTEGRATION possibles         =
C=          (voir la description de INTTYP ci-dessus)                  =
C= NINFOS : Dimension (JG) du tableau infell (segment INFO) = 16       =
C= On sauvegarde dans INTEGR(I,J) le pointeur sur un segment d'inte-   =
C= gration correspondant a l'element fini de type I et une integration =
C= de type J.                                                          =
C=======================================================================
C Valeurs de IFOMOD : -1     0     1     2     3     4     5     6
C                    PLAN  AXIS  FOUR  TRID  UNID  UNID  UNID  FREQ
C                                            PLAN  AXIS  SPHE
      PARAMETER ( NELFI = 300 , NTYNTE = 9 , NBMODE = 8 )
      PARAMETER ( NINTEG = NELFI * NTYNTE * NBMODE , NINFOS = 16 )

      INTEGER INTEGR(NELFI,NTYNTE,NBMODE),TYINTE

      logical dcmate,dcmat2

      SAVE INTEGR
      DATA INTEGR / NINTEG*0 /

      IPTR = 0

C Tests de verification :
      IF (NELFI.LT.LNOMTP) THEN
        WRITE(IOIMP,*)
        WRITE(IOIMP,*) 'ELQUOI : valeur de NELFI incorrecte !'
        WRITE(IOIMP,*) '         NELFI  = ',NELFI,LNOMTP
        CALL ERREUR(5)
        RETURN
      ENDIF
C On se place sur la bonne "tranche" du tableau INTEGR :
      IBMODE = IFOMOD + 2
      IF (NBMODE.LT.IBMODE) THEN
        WRITE(IOIMP,*)
        WRITE(IOIMP,*) 'ELQUOI : valeur de NBMODE incorrecte !'
        WRITE(IOIMP,*) '         IBMODE = ',IBMODE,NBMODE,IFOMOD
        CALL ERREUR(5)
        RETURN
      ENDIF
C Quel(s) type(s) de segment est(sont) a traiter ?
      TYINTE = INTTYP
      IF (INTTYP.EQ.-10) TYINTE = 0

      IMODEL = IPMODL
c*      SEGACT,imodel*MOD

      dcmat2 = .false.
C  Recuperation des donnees de infell en entree
      MELE = NELE
      NBGS = NBPOIN
      IELE = NUMGEO(MELE)
      MFR = NUMMFR(MELE)
C
      dcmate = .false.
      do im = 1, imodel.matmod(/2)
        if (imodel.matmod(im).eq.'IMPEDANCE') then
          dcmate = .true.
          meleme = imodel.imamod
          segact meleme*nomod
          ityp1 = meleme.itypel
c*          segdes,meleme
c* Le segdes genere une erreur par la suite, mais doit-on aussi activer
c* ce segment ici (activation au-dessus ?)
          mfr = nummfr(mele)
          if (ityp1.eq.1) mele = 45
          iele = numgeo(mele)
        endif
       enddo
C  Nombre de points d'integration dans l'epaisseur (stocke dans IMODEL)
      NPINT=0
      IF (imodel.INFMOD(/1).NE.0) NPINT = imodel.INFMOD(1)
c       IF(MELE.EQ.263) NPINT=0
C  Initialisation
      IPT2 = 0
      JG = NINFOS
      SEGINI,INFO

C=---------------------------------------------------------------------=
C= REMPLISSAGE DU TABLEAU infell
C=---------------------------------------------------------------------=
C  Remplissage de infell(1) : numero de l'element fini
C  --------------------------
      INFELL(1)=NELE

C  Remplissage de infell(8) :
C  --------------------------
C  Sauf cas particuliers, le nombre de fonctions de forme de l'element
C  fini est egal au nombre de noeuds de l'element geometrique support.
      INFELL(8) = NBNNE(IELE)
C  Massifs : TRIx-QUAx 4 a 11, CUxx a PRxx 14 a 17, TExx-PYxx 23 a 26
      IF (MELE.GE.4.AND.MELE.LE.11) THEN
        INFELL(8) = 3
      ELSE IF (MELE.GE.14.AND.MELE.LE.17) THEN
        infell(8) = 3
      ELSE IF (MELE.GE.23.AND.MELE.LE.26) THEN
        infell(8) = 3
C  Polygones : POxx 111 a 122
      ELSE IF (MELE.GE.111.AND.MELE.LE.122) THEN
        IF (MELE.EQ.111) infell(8) = 3
        IF (MELE.EQ.112) infell(8) = 4
        IF (MELE.EQ.113) infell(8) = 5
        IF (MELE.EQ.114) infell(8) = 6
        IF (MELE.EQ.115) infell(8) = 7
        IF (MELE.EQ.116) infell(8) = 8
        IF (MELE.EQ.117) infell(8) = 9
        IF (MELE.EQ.118) infell(8) = 10
        IF (MELE.EQ.119) infell(8) = 11
        IF (MELE.EQ.120) infell(8) = 12
        IF (MELE.EQ.121) infell(8) = 13
        IF (MELE.EQ.122) infell(8) = 14
C  Elements QxRI 183 a 184
      ELSE IF (MELE.EQ.183.OR.MELE.EQ.184) THEN
        infell(8) = 3
CTY Element XQ4R (xfem meca rupture en 2D)
      ELSEIF(MELE.eq.263) THEN
        infell(8)=40
CTY Element XC8R (xfem meca rupture en 3D)
      ELSE IF(MELE.eq.264) THEN
        infell(8)=80
      ENDIF

C  Elements Navier Stokes : cas P1CENTRE
      IF(TYINTE.EQ.8) THEN
C        cas MACRO 2D QUAF 2D --> TRI3
        IF(MELE.EQ.217.OR.MELE.EQ.224.OR.MELE.EQ.231
     &  .OR.MELE.EQ.238.OR.MELE.EQ.245.OR.MELE.EQ.252)
     &   infell(8) = 3
C        cas MACRO 2D QUAF 2D --> QUA4
        IF(MELE.EQ.218.OR.MELE.EQ.225.OR.MELE.EQ.232
     &  .OR.MELE.EQ.239.OR.MELE.EQ.246.OR.MELE.EQ.253)
     &   infell(8) = 3
C        cas MACRO 3D QUAF 3D
C        IF((MELE.GE.226.AND.MELE.LE.229).OR.
C     &   (MELE.GE.247.AND.MELE.LE.250))  infell(8) = 4
      ENDIF
C  Elements Navier Stokes : cas MSOMMET
      IF(TYINTE.EQ.9) THEN
C        cas MACRO QUAF 1D --> SEG2
        IF(MELE.EQ.216.OR.MELE.EQ.223.OR.MELE.EQ.230
     &  .OR.MELE.EQ.237.OR.MELE.EQ.244.OR.MELE.EQ.251) IELE = 2
C        cas MACRO QUAF 2D --> TRI3
        IF(MELE.EQ.217.OR.MELE.EQ.224.OR.MELE.EQ.231
     &  .OR.MELE.EQ.238.OR.MELE.EQ.245.OR.MELE.EQ.252) IELE = 4
C        cas MACRO QUAF 2D --> QUA4
        IF(MELE.EQ.218.OR.MELE.EQ.225.OR.MELE.EQ.232
     &  .OR.MELE.EQ.239.OR.MELE.EQ.246.OR.MELE.EQ.253) IELE = 8
C        cas MACRO QUAF 3D --> CUB8
        IF(MELE.EQ.233.OR.MELE.EQ.254) IELE = 14
C        cas MACRO QUAF 3D --> PRI6
        IF(MELE.EQ.234.OR.MELE.EQ.255) IELE = 16
C        cas MACRO QUAF 3D --> TET4
        IF(MELE.EQ.235.OR.MELE.EQ.256) IELE = 23
C        cas MACRO QUAF 3D --> PYR5
        IF(MELE.EQ.236.OR.MELE.EQ.257) IELE = 25
        infell(8) = NBNNE(IELE)
        infell(14)= IELE
      ENDIF

C  Pour les elements xxxP (79 a 83), TUYO (96), JOPx (108 a 110), xxxQ
C  (173 a 177), xxxR (178 a 182), JORx (185 a 187) et JOQx(188 a 190),
C  infell(8) est affecte lors du remplissage complet de infell.

C  Remplissage de infell(13) et infell(14) :
C  -----------------------------------------
C  infell(13) : numero de la FORMULATION - MFR=NUMMFR(NELE)
      infell(13) = MFR
      do im = 1,matmod(/2)
       if (MFR.eq.27.and.matmod(im).eq.'MODAL') infell(13) = 26
       if (MFR.eq.27.and.matmod(im).eq.'STATIQUE') infell(13) = 28
      enddo
      IF (FORMOD(1).EQ.'CHARGEMENT') THEN
        IF (MFR.EQ.1) INFELL(13)=72
        IF (MFR.EQ.3.OR.MFR.EQ.5.OR.MFR.EQ.7.OR.MFR.EQ.9.OR.
     &      MFR.EQ.13) INFELL(13) = 74
      ENDIF
      MFR = infell(13)
      mfr3 = nummfr(nele)
C mfr2 non nul en cas de formulation massive non mecanique
      mfr2 = 0
      if (MFR.EQ.26.OR.MFR.EQ.28) mfr3 = mfr
C  Cas particuliers : elements HYxx (99 a 103)
C  MFR = NUMMFR(mele) = 45  mais infell(13)=1 (MASSIF)
      IF (MELE.GE.99.AND.MELE.LE.103) infell(13)=1

C  ELECTROSTATIQUE : MFR=71=infell(13) et NUMMFR(mele)=1 (MASSIF)
      IF (FORMOD(1).EQ.'ELECTROSTATIQUE') mfr2=71

C  DIFFUSION : MFR=73=infell(13) et NUMMFR(mele)=1 (MASSIF)
      IF (FORMOD(1).EQ.'DIFFUSION') THEN
        IF (MFR .EQ. 1) THEN
          infell(13)=73
        ELSE
          infell(13)=MFR
        ENDIF
      ENDIF

      IF (mfr2.NE.0) infell(13) = mfr2
C
C  infell(14) : numero de l'element GEOMETRIQUE - IELE=NUMGEO(NELE)
      infell(14) = IELE

C  Remplissage de infell(10), infell(15) et infell(16) :
C  -----------------------------------------------------
C  infell(10) : dimension de la matrice de Hooke
C  infell(15) : nombre maximal de ddl par noeud
C  infell(16) : nombre de composantes de contraintes et deformations

C  MASSIFs (2D) : TRIx-QUAx 4 a 11 + POLYgones : POLY 111 a 122 +
C  Elements QxRI 183 a 184
      IF ((MELE.GE.4.AND.MELE.LE.11).OR.(MELE.GE.111.AND.MELE.LE.122)
     . .OR.MELE.EQ.183.OR.MELE.EQ.184) THEN
        IF (IFOUR.EQ.1) THEN
          infell(10)=6
          infell(15)=3
          infell(16)=6
        ELSE
          infell(10)=4
          infell(15)=2
          infell(16)=4
        ENDIF
C  MASSIFs (3D) : CUxx-PRxx 14 a 17, TExx-PYxx 23 a 26
      ELSE IF ((MELE.GE.14.AND.MELE.LE.17).OR.
     .         (MELE.GE.23.AND.MELE.LE.26)) THEN
        infell(10)=6
        infell(15)=3
        infell(16)=6
C  Elements LIQUIDE : Lxxx 35 a 40
      ELSE IF (MELE.GE.35.AND.MELE.LE.40) THEN
        infell(10)=5
        infell(15)=2
        infell(16)=0
C  Elements de RACCORD FLUIDE-STRUCTURE :
C  RAC2 12, LIAx 18 a 19, RACO 47, LICO 55, LIC4 94
      ELSE IF (MELE.EQ.12.OR.MELE.EQ.18.OR.MELE.EQ.19.OR.MELE.EQ.47.OR.
     .         MELE.EQ.55.OR.MELE.EQ.94) THEN
         infell(10)=6
C  Elements de SURFACE LIBRE : LSU2 48, LSU3 53, LSU4 54
      ELSE IF (MELE.EQ.48.OR.MELE.EQ.53.OR.MELE.EQ.54) THEN
        infell(10)=6
        infell(15)=3
C  Elements THERMIQUEs : CVxx 57 a 62, THxx 63 a 68
      ELSE IF (MELE.GE.57.AND.MELE.LE.68) THEN
        IF (MELE.LE.60) THEN
          infell(10)=2
          infell(15)=1
          infell(16)=2
        ELSE IF (MELE.GE.61) THEN
          infell(10)=3
          infell(15)=1
          infell(16)=3
        ENDIF
C  Elements MASSIFs IMCOMPRESSIBLES : ICxx 69 a 78
      ELSE IF (MELE.GE.69.AND.MELE.LE.78) THEN
        IF (MELE.LE.72) THEN
          infell(10)=4
C**       IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(10)=4
          infell(15)=2
          IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(15)=3
          infell(16)=4
C**       IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(16)=4
        ELSE IF (MELE.GE.73) THEN
          infell(10)=6
          infell(15)=3
          infell(16)=6
        ENDIF
C  Elements MASSIFs POREUX : xxxP 79 a 83
      ELSE IF (MELE.GE.79.AND.MELE.LE.83) THEN
        IF (MELE.LE.80) THEN
          IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) THEN
            infell(10)=6
            infell(15)=4
            infell(16)=7
          ELSE
            infell(10)=4
            infell(15)=3
            infell(16)=5
          ENDIF
        ELSE IF (MELE.GE.81) THEN
          infell(10)=6
          infell(15)=4
          infell(16)=7
        ENDIF
C  Elements MASSIFs POREUX de type Q : xxxQ 173 a 177
      ELSE IF (MELE.GE.173.AND.MELE.LE.177) THEN
        IF (MELE.LE.174) THEN
          IF (IFOUR.EQ.1) THEN
            infell(10)=8
            infell(15)=5
            infell(16)=8
          ELSE
            infell(10)=6
            infell(15)=4
            infell(16)=6
          ENDIF
        ELSE IF (MELE.GE.175) THEN
          infell(10)=8
          infell(15)=5
          infell(16)=8
        ENDIF
C  Elements MASSIFs POREUX de type R : xxxR 178 a 182
      ELSE IF(MELE.GE.178.AND.MELE.LE.182) THEN
        IF (MELE.LE.179) THEN
          IF (IFOUR.EQ.1) THEN
            infell(10)=9
            infell(15)=6
            infell(16)=9
          ELSE
            infell(10)=7
            infell(15)=5
            infell(16)=7
          ENDIF
        ELSE IF (MELE.GE.180) THEN
          infell(10)=9
          infell(15)=6
          infell(16)=9
        ENDIF
C  Elements JOINTS : JOxx 85 a 90
      ELSE IF (MELE.GE.85.AND.MELE.LE.90) THEN
        IF (MELE.LE.86) THEN
          infell(10)=2
          infell(16)=2
        ELSE IF (MELE.GE.87) THEN
          infell(10)=3
          infell(16)=3
        ENDIF
C
C     MACRO ELEMENT CISAILLEMENT FLEXION
C
       ELSE IF(MELE.EQ.191) THEN
          infell(5)=3
          infell(7)=300
          GO TO 258

C  Elements JOINTs CISAILLEMENT et GENERALISES : JCxx-JGxx 168 a 172
      ELSE IF (MELE.GE.168.AND.MELE.LE.172) THEN
        infell(7)=300
        infell(9)=infell(8)*IDIM
        infell(15)=IDIM
        IF (MELE.EQ.168.OR.MELE.EQ.169) THEN
          infell(10)=2
          infell(16)=2
        ELSE IF (MELE.EQ.170) THEN
          infell(10)=4
          infell(16)=4
        ELSE
          infell(10)=6
          infell(16)=6
        ENDIF
C  Elements HOMOGENEISES : TRIH 92, QUAH 126, CUBH 127, TRH6 157
      ELSE IF (MELE.EQ.92.OR.MELE.EQ.126.OR.MELE.EQ.127.OR.
     .         MELE.EQ.157) THEN
        infell(10)=10
        infell(16)=0
C  Elements JOINTS POREUX : JOPx 108 a 110
      ELSE IF (MELE.GE.108.AND.MELE.LE.110) THEN
        infell(7)=100
C  Elements JOINTS POREUX de type Q : JOQx 185 a 187
      ELSE IF (MELE.GE.185.AND.MELE.LE.187) THEN
        infell(7)=150
C  Elements JOINTS POREUX de type R : JORx 188 a 190
      ELSE IF (MELE.GE.188.AND.MELE.LE.190) THEN
        infell(7)=200
C  Elements MASSIFS THERMIQUE/MECANIQUE en 1D : T1Dx-M1Dx 191 a 194
      ELSE IF (MELE.GE.191.AND.MELE.LE.194) THEN
        infell(10)=3
        infell(15)=1
        infell(16)=3
      ENDIF
C  Cas particuliers des autres formulations massives (mfr2 > 0)
      IF (mfr2.NE.0) THEN
        infell(10)=IDIM
        infell(15)=1
        infell(16)=IDIM
      ENDIF
C  Pour les autres elements, les valeurs de infell(10,15,16) sont
C  eventuellement affectees (0 par defaut) lors du branchement (GOTO)
C  ci-dessous qui effectue le remplissage complet du tableau infell.

C  Remplissage complet du tableau infell suivant l'element fini
C --------------------------------------------------------------
      IF(MELE.GE.1.AND.MELE.LE.194) THEN
C            CABL SEG2 SEG3 TRI3 TRI4 TRI6 TRI7 QUA4 QUA5 QUA8 QUA9,RAC2
      GOTO (  300,   2,   3,   4, 300,   6, 300,   8, 300,  10, 300,  12
C            RAC3 CUB8 CU20 PRI6 PR15 LIA3 LIA4 LIA6 LIA8 MULT TET4 TE10
     .      , 300,  14,  15,  16,  17,  18,  19, 300, 300, 300,  23,  24
C            PYR5 PY13 COQ3  DKT POUT LISP FAC3 FAC4 FAC6 FAC8 LTR3 LQU4
     .      ,  25,  26,  27,  28,  29,  30,  31,  32,  33,  34,  35,  36
C            LCU8 LPR6 LTE4 LPY5 COQ8 TUYA TUFI COQ2 POI1 BARR RACO LSU2
     .      ,  37,  38,  39,  40,  41,  42,  43,  44,  45,  46,  47,  48
C            COQ4 LISM COF3 RES2 LSU3 LSU4 LICO COQ6 CVS2 CVS3 CVT3 CVT6
     .      ,  49,  50,  51, 300,  53,  54,  55,  56,  57,  58,  59,  60
C            CVQ4 CVQ8 THP5 TH13 THP6 TH15 THC8 TH20 ICT3 ICQ4 ICT6 ICQ8
     .      ,  61,  62,  63,  64,  65,  66,  67,  68,  69,  70,  71,  72
C            ICC8 ICT4 ICP6 IC20 IC10 IC15 TRIP QUAP CUBP TETP PRIP TIMO
     .      ,  73,  74,  75,  76,  77,  78,  79,  80,  81,  82,  83,  84
C            JOI2 JOI3 JOT3 JOI4 JOI6 JOI8 LISC TRIH  DST LIC4 CERC TUYO
     .      ,  85,  86,  87,  88,  89,  90,  91,  92,  93,  94,  95,  96
C            LSE2 LITU HYT3 HYQ4 HYT4 HYP6 HYC8 TRIS QUAS POIS FOR3 JOP3
     .      ,  97,  98,  99, 100, 101, 102, 103, 104, 105, 106, 300, 108
C            JOP6 JOP8 POL3 POL4 POL5 POL6 POL7 POL8 POL9 PO10 PO11 PO12
     .      , 109, 110, 111, 111, 111, 111, 111, 111, 111, 111, 111, 111
C            PO13 PO14 BAR3 BAEX LIA2 QUAH CUBH ROT3 SEF2 TRF3 QUF4 CUF8
     .      , 111, 111, 123, 124, 125, 126, 127, 128, 300, 300, 300, 300
C            PRF6 TEF4 PYF5 MSE3 MTR6 MQU9 MC27 MP18 MT10 MP14 SEF3 TRF7
     .      , 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300
C            QUF9 CF27 PF21 TF15 PF19 SEG6 TR21 QU36 C216 P126 TE56 PY91
     .      , 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300
C            TRH6 BSE2 BTR4 BQU5 BCU9 BPR7 BTE5 BPY6 FRO4 SEGS POJS JCT3
     .      , 157, 300, 300, 300, 300, 300, 300, 300, 300, 166, 167, 168
C            JCI4 JGI2 JGT3 JGI4 TRIQ QUAQ CUBQ TETQ PRIQ TRIR QUAR CUBR
     .      , 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180
C            TETR PRIR Q4RI Q8RI JOQ3 JOQ6 JOQ8 JOR3 JOR6 JOR8 T1D2 T1D3
     .      , 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192
C            M1D2 M1D3
     .      , 191, 192 ), MELE
      ELSEIF(MELE.GE.195.AND.MELE.LE.272) THEN
C             LC03  LC07  LC09  LC27  LC21  LC15  LC19
      GOTO (  195, 196, 197, 300, 300, 300, 300
C             LS03  LS07  LS09  LS27  LS21  LS15  LS19
     .      , 195, 196, 197, 300, 300, 300, 300
C             BS03  BS07  BS09  BS27  BS21  BS15  BS19
     .      , 195, 196, 197, 300, 300, 300, 300
C             MC03 MC07 MC09 MC27 MC21 MC15 MC19
     .      , 216, 217, 218, 300, 300, 300, 300
C             M103 M107 M109 M127 M121 M115 M119
     .      , 223, 224, 225, 300, 300, 300, 300
C             MS03 MS07 MS09 MS27 MS21 MS15 MS19
     .      , 223, 224, 225, 300, 300, 300, 300
C             QC03 QC07 QC09 QC27 QC21 QC15 QC19
     .      , 237, 238, 239, 300, 300, 300, 300
C             Q103 Q107 Q109 Q127 Q121 Q115 Q119
     .      , 237, 238, 239, 300, 300, 300, 300
C             QS03 QS07 QS09 QS27 QS21 QS15 QS19 CIFL SURE
     .      , 237, 238, 239, 300, 300, 300, 300, 300, 300
C             SHB8 caf2 caf3 xq4r xc8r joi1 ZCO2 ZCO3 ZCO4 TUY2 TUY3 COS2
     .      , 260, 300, 300, 263, 264, 265, 266, 267, 268, 269, 270, 271
C             COA2 ICY5 IC13
     .      , 272,  25,  26)
c cccccc
     .       , (MELE-194)
      ENDIF
C
C  Remplissage de infell pour chaque element
C -------------------------------------------
C  Element SEG2
 2    infell(2)=2
      infell(4)=2
      infell(6)=2
C**   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=3
      infell(7)=0
      infell(9)=4
      IF (IFOUR.EQ.1) infell(9)=6
      infell(10)=1
      infell(15)=2
      IF (IFOUR.EQ.1) infell(15)=3
      infell(16)=1
      GOTO 300
C  Element SEG3
 3    infell(2)=3
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(2)=4
      infell(4)=3
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(4)=4
      infell(6)=3
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=4
      infell(7)=0
      infell(9)=6
      IF (IFOUR.EQ.1) infell(9)=9
      infell(10)=1
      infell(15)=2
      IF (IFOUR.EQ.1) infell(15)=3
      infell(16)=1
      GOTO 300
C  Element TRI3
 4    infell(2)=1
      infell(3)=4
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=7
      infell(4)=1
      infell(6)=1
C     IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=4
      infell(9)=6
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(9)=9
      GOTO 300
C  Element TRI6
 6    IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) THEN
        infell(2)=7
        infell(4)=7
        infell(6)=7
      ELSE
        infell(2)=4
        infell(4)=4
        infell(6)=4
      ENDIF
      infell(3)=7
      infell(9)=12
      IF (IFOUR.EQ.-3) infell(9)=15
      IF (IFOUR.EQ.1) infell(9)=18
      GOTO 300
C  Element QUA4
 8    infell(2)=4
      infell(3)=4
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=9
      infell(4)=4
C**   infell(4)=5    CORRECTION  MILL  LE 8/8/90
      infell(6)=4
C**   IF(IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=9
      infell(9)=8
      IF (IFOUR.EQ.-3) infell(9)=11
      IF (IFOUR.EQ.1) infell(9)=12
      GOTO 300
C  Element QUA8
 10   infell(2)=9
      infell(3)=9
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=16
      infell(4)=9
      infell(6)=9
C     IF(IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=16
      infell(9)=16
      IF (IFOUR.EQ.-3) infell(9)=19
      IF (IFOUR.EQ.1) infell(9)=24
      GOTO 300
C  Element RAC2 (raccord a 4 noeuds en 2 dimensions)
 12   infell(2)=2
      infell(4)=2
      infell(5)=2
      infell(6)=2
      infell(9)=8
      IF (IFOUR.EQ.1) infell(9)=10
      infell(15)=3
      GOTO 300
C  Element CUB8
 14   infell(2)=8
      infell(3)=8
      infell(4)=8
      infell(6)=8
      infell(9)=24
      GOTO 300
C  Element CU20
 15   infell(2)=27
      infell(3)=27
      infell(4)=27
      infell(6)=27
      infell(9)=60
      GOTO 300
C  Element PRI6
 16   infell(2)=6
cbp      infell(3)=6
      infell(3)=8
      infell(4)=6
      infell(6)=6
      infell(9)=18
      GOTO 300
C  Element PR15
 17   infell(2)=12
cbp      infell(3)=12
      infell(3)=21
      infell(4)=12
      infell(6)=12
      infell(9)=45
      GOTO 300
C  Element LIA3 (raccord a 6 noeudes en 3 dimensions)
 18   infell(2)=4
      infell(4)=4
      infell(5)=3
      infell(6)=4
      infell(9)=15
      infell(13)=19
      infell(15)=3
      GOTO 300
C  Element LIA4 (raccord a 8 noeuds en 3 dimensions)
 19   infell(2)=4
      infell(4)=4
      infell(5)=3
      infell(6)=4
      infell(9)=20
      infell(15)=3
      GOTO 300
C  Element TET4
 23   infell(2)=1
      infell(3)=4
      infell(4)=1
      infell(6)=1
      infell(9)=12
      GOTO 300
C  Element TE10
 24   infell(2)=5
cbp      infell(3)=5
      infell(3)=15
      infell(4)=5
      infell(6)=5
      infell(9)=30
      GOTO 300
C  Element PYR5
 25   infell(2)=5
      infell(3)=5
      infell(4)=5
      infell(6)=5
      infell(9)=15
      GOTO 300
C  Element PY13
cbp  26   infell(2)=27
cbp       infell(3)=27
cbp       infell(4)=27
cbp       infell(6)=27
 26   infell(2)=10
      infell(3)=17
      infell(4)=10
      infell(6)=10
      infell(9)=39
      GOTO 300
C  Element COQ3
 27   infell(2)=3
      infell(4)=1
      infell(5)=3
      infell(6)=1
      infell(7)=600
      infell(9)=18
      IF (FORMOD(1) .EQ. 'DIFFUSION') infell(9)=9
      infell(10)=6
      infell(15)=6
      infell(16)=6
      GOTO 300
C  Element DKT
 28   infell(2)=3
      infell(3)=3
      infell(5)=3
      infell(7)=600
      infell(9)=18
      infell(15)=6
      IF (NPINT.EQ.0) THEN
C  Element DKT COQUE GLOBALE
        infell(4)=3
        infell(6)=3
        infell(10)=6
        infell(16)=6
      ELSE
C  Element DKT COQUE INTEGREE dans l'epaisseur
        infell(4)=3*NPINT
        infell(6)=3*NPINT
        infell(10)=6
        infell(16)=4
      ENDIF
      GOTO 300
C  Element POUTRE
 29   infell(2)=2
      infell(4)=2
      infell(6)=2
      infell(7)=200
      IF (IFOUR.EQ.-3.OR.IFOUR.EQ.-2.OR.IFOUR.EQ.-1) THEN
C Element POUTRE 2D plan
        infell(5)=6
        infell(9)=6
        infell(10)=3
        infell(15)=3
        infell(16)=3
      ELSE
C Element POUTRE 3D
        infell(5)=12
        infell(9)=12
        infell(10)=6
        infell(15)=6
        infell(16)=6
      ENDIF
      GOTO 300
C  Element LINE SPRING LISP
 30   infell(2)=3
      infell(13)=15
      infell(6)=3
      infell(4)=3
      infell(16)=6
      infell(9)=24
      infell(7)=100
      infell(10)=6
      infell(15)=6
      infell(5)=5
      GOTO 300
C  Element FAC3 pour les PRESSIONS uniquement
 31   infell(2)=1
      infell(4)=1
      infell(6)=1
      infell(9)=9
      infell(15)=3
      GOTO 300
C  Element FAC4 pour les PRESSIONS uniquement
 32   infell(2)=4
      infell(4)=4
      infell(6)=4
      infell(9)=12
      infell(15)=3
      GOTO 300
C  Element FAC6 pour les PRESSIONS uniquement
 33   infell(2)=4
      infell(4)=4
      infell(6)=4
      infell(9)=18
      infell(15)=3
      GOTO 300
C  Element FAC8 pour les PRESSIONS uniquement
 34   infell(2)=9
      infell(4)=9
      infell(6)=9
      infell(9)=24
      infell(15)=3
      GOTO 300
C  Element LTR3 : element LIQUIDE triangle a 3 noeuds
 35   infell(2)=4
      infell(3)=4
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=7
      infell(4)=4
      infell(6)=4
      infell(9)=6
      GOTO 300
C  Element LQU4 : element LIQUIDE quadrangle a 4 noeuds
 36   infell(2)=4
      infell(3)=4
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=9
      infell(4)=4
      infell(6)=4
      infell(9)=8
      GOTO 300
C  Element LCU8 : Element LIQUIDE CUBE a 8 noeuds
 37   infell(2)=8
      infell(3)=8
      infell(4)=8
      infell(6)=8
      infell(9)=16
      GOTO 300
C  Element LPR6 : Element LIQUIDE PRISME a 6 noeuds
 38   infell(2)=6
      infell(3)=6
      infell(4)=6
      infell(6)=6
      infell(9)=12
      GOTO 300
C  Element LTE4 : Element LIQUIDE TETRAEDRE a 4 noeuds
 39   infell(2)=4
      infell(3)=4
      infell(4)=4
      infell(6)=4
      infell(9)=8
      GOTO 300
C  Element LPY5 : Element LIQUIDE PYRAMIDE a 5 noeuds
 40   infell(2)=5
      infell(3)=5
      infell(4)=5
      infell(6)=5
      infell(9)=10
      GOTO 300
C  Element COQ8 : Element COQUE EPAISSE a 8 noeuds
 41   infell(2)=NBGS
      IF (NBGS.EQ.0) infell(2)=8
      infell(3)=8
      infell(4)=NBGS
      IF (NBGS.EQ.0) infell(4)=8
      infell(5)=2
      infell(6)=8
      infell(7)=1700
      infell(9)=48
      IF (FORMOD(1) .EQ. 'DIFFUSION') infell(9)=24
      infell(10)=5
      infell(15)=6
      infell(16)=5
      GOTO 300
C  Element TUYA : Element TUYAU
 42   infell(2)=2
      infell(4)=2
      infell(5)=7
      infell(6)=2
      infell(7)=200
      infell(9)=12
      infell(10)=6
      infell(15)=6
      infell(16)=6
      GOTO 300
C  Element TUFI : Element TUYAU FISSURE
 43   infell(2)=1
      infell(3)=0
      infell(4)=1
      infell(5)=9
      infell(6)=1
      infell(7)=200
      infell(9)=12
      infell(10)=6
      infell(15)=6
      infell(16)=8
      GOTO 300
C  Element COQ2
 44   infell(2)=3
      infell(3)=3
      infell(4)=3
      infell(5)=3
      infell(6)=3
      infell(7)=368
      infell(9)=8
      IF (IFOUR.EQ.-2.OR.IFOUR.EQ.-1.OR.IFOUR.EQ.0) infell(9)=6
      IF (IFOUR.EQ.-3) infell(9)=9
      infell(10)=6
      IF (IFOUR.LE.0) infell(10)=4
      infell(15)=4
      IF (IFOUR.EQ.-2.OR.IFOUR.EQ.-1.OR.IFOUR.EQ.0) infell(15)=3
      infell(16)=6
      IF (IFOUR.LE.0) infell(16)=4
      GOTO 300
C  Element POI1 (MODEs en DEFOrmations PLANes GENEralisees)
C  Valeurs a adapter pour certains MODE UNID (1D)
 45   infell(2)=1
      infell(3)=1
      infell(4)=1
      infell(5)=1
      infell(6)=1
      infell(7)=50
      infell(15)=2
      IF (IFOUR.EQ.11) THEN
        infell(9)=3
        infell(10)=2
        infell(16)=2
      ELSE
        infell(9)=5
        IF (IFOUR.GE.3.AND.IFOUR.LE.15) infell(9)=2
        infell(10)=1
        infell(16)=1
      ENDIF
      if (mfr.eq.26.or.mfr.eq.28) infell(9) = 1
      GOTO 300
C  Element BARRE
 46   infell(2)=2
      infell(4)=2
      infell(5)=1
      infell(6)=2
      infell(7)=200
      infell(9)=6
      IF (IFOUR.EQ.-2.OR.IFOUR.EQ.-1.OR.IFOUR.EQ.0) infell(9)=4
      IF (IFOUR.EQ.-3) infell(9)=7
      IF (FORMOD(1) .EQ. 'DIFFUSION') infell(9)=2
      infell(10)=1
      infell(15)=3
      IF (FORMOD(1) .EQ. 'DIFFUSION') infell(15)=1
      IF (IFOUR.EQ.-2.OR.IFOUR.EQ.-1.OR.IFOUR.EQ.0) infell(15)=2
      infell(16)=1
      GOTO 300
C  Element RACO : Element de RACCORD LIQUIDE-COQUE a 4 noeuds en 2D
 47   infell(2)=1
      infell(4)=1
      infell(5)=2
      infell(6)=1
      infell(9)=10
      IF (IFOUR.EQ.1) infell(9)=12
      infell(15)=4
      GOTO 300
C  Element LSU2 : Element de SURFACE LIBRE a 2 noeuds en 2D
 48   infell(2)=2
      infell(4)=2
      infell(6)=2
      infell(9)=6
      GOTO 300
C  Element COQ4
 49   infell(2)=5
      infell(3)=5
      infell(4)=5
      infell(5)=3
      infell(6)=5
      infell(7)=100
      infell(9)=24
      IF (FORMOD(1) .EQ. 'DIFFUSION') infell(9)=12
      infell(10)=8
      infell(15)=6
      infell(16)=8
      GOTO 300
C  Element LINE SPRING LISM
 50   infell(2)=1
      infell(4)=1
      infell(5)=5
      infell(6)=3
      infell(7)=100
      infell(9)=24
      infell(10)=6
      infell(15)=6
      infell(16)=6
      GOTO 300
C  Element COF3
 51   infell(2)=3
      infell(3)=3
      infell(4)=3
      infell(5)=3
      infell(6)=3
      infell(9)=12
      infell(7)=368
      infell(10)=6
      infell(15)=4
      infell(16)=6
      GOTO 300
C  Element LSU3 : Element de SURFACE LIBRE a 3 noeuds en 3D
 53   infell(2)=4
      infell(4)=4
      infell(6)=4
      infell(9)=9
      GOTO 300
C  Element LSU4 : Element de SURFACE LIBRE a 4 noeuds en 3D
 54   infell(2)=4
      infell(4)=4
      infell(6)=4
      infell(9)=12
      GOTO 300
C  Element LICO : Element de RACCORD LIQUIDE-COQUE a 6 noeuds en 3D
 55   infell(2)=3
      infell(4)=3
      infell(5)=3
      infell(6)=3
      infell(9)=24
      infell(15)=6
      GOTO 300
C  Element COQ6 : Element COQUE EPAISSE a 6 noeuds
 56   infell(2)=NBGS
      IF(NBGS.EQ.0) infell(2)=6
      infell(3)=6
      infell(4)=NBGS
      IF (NBGS.EQ.0) infell(4)=6
      infell(5)=2
      infell(6)=6
      infell(9)=36
      IF (FORMOD(1) .EQ. 'DIFFUSION') infell(9)=18
      infell(7)=1000
      infell(10)=5
      infell(15)=6
      infell(16)=5
      GOTO 300
C  Element THT3 (thermique)
 57   infell(2)=1
      infell(6)=1
C**   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=4
      infell(9)=3
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(9)=9
      GOTO 300
C  Element THT6
 58   infell(2)=4
      infell(4)=4
      infell(6)=4
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=7
      infell(9)=6
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(9)=18
      GOTO 300
C  Element THQ4
 59   infell(2)=4
      infell(6)=4
C**   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=9
      infell(9)=4
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(9)=12
      GOTO 300
C  Element THQ8
 60   infell(2)=9
      infell(6)=9
C**   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=16
      infell(9)=8
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(9)=24
      GOTO 300
C  Element THT4
 61   infell(2)=1
      infell(6)=1
      infell(9)=4
      GOTO 300
C  Element TH10
 62   infell(2)=5
      infell(6)=5
      infell(9)=10
      GOTO 300
C  Element THP5
 63   infell(2)=5
      infell(6)=5
      infell(9)=5
      GOTO 300
C  Element TH13
 64   infell(2)=27
      infell(6)=27
      infell(9)=13
      GOTO 300
C  Element THP6
 65   infell(2)=2
      infell(6)=2
      infell(9)=6
      GOTO 300
C  Element TH15
 66   infell(2)=12
      infell(6)=12
      infell(9)=15
      GOTO 300
C  Element THC8
 67   infell(2)=8
      infell(6)=8
      infell(9)=8
      GOTO 300
C  Element TH20
 68   infell(2)=27
      infell(6)=27
      infell(9)=20
      GOTO 300
C  Element ICT3
 69   infell(2)=1
      infell(3)=4
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=7
      infell(4)=1
      infell(6)=1
C**   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=4
      infell(9)=6
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(9)=9
      GOTO 300
C  Element ICQ4
 70   infell(2)=4
      infell(3)=4
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=9
      infell(4)=4
C**   infell(4)=5    CORRECTION  MILL  LE 8/8/90
      infell(6)=4
C**   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=9
      infell(9)=8
      IF (IFOUR.EQ.-3) infell(9)=11
      IF (IFOUR.EQ.1) infell(9)=12
      GOTO 300
C  Element ICT6
 71   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) THEN
        infell(2)=7
        infell(4)=7
        infell(6)=7
      ELSE
        infell(2)=4
        infell(4)=4
        infell(6)=4
      ENDIF
      infell(3)=7
      infell(9)=12
      IF (IFOUR.EQ.-3) infell(9)=15
      IF (IFOUR.EQ.1) infell(9)=18
      GOTO 300
C  Element ICQ8
 72   infell(2)=9
      infell(3)=9
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=16
      infell(4)=9
      infell(6)=9
C**   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=16
      infell(9)=16
      IF (IFOUR.EQ.-3) infell(9)=19
      IF (IFOUR.EQ.1) infell(9)=24
      GOTO 300
C  Element ICC8
 73   infell(2)=8
      infell(3)=8
      infell(4)=8
      infell(6)=8
      infell(9)=24
      GOTO 300
C  Element ICT4
 74   infell(2)=4
      infell(3)=5
      infell(4)=4
      infell(6)=4
      infell(9)=12
      GOTO 300
C  Element ICP6
 75   infell(2)=2
      infell(3)=6
      infell(4)=2
      infell(6)=2
      infell(9)=18
      GOTO 300
C  Element IC20
 76   infell(2)=27
      infell(3)=27
      infell(4)=27
      infell(6)=27
      infell(9)=60
      GOTO 300
C  Element IC10
 77   infell(2)=5
      infell(3)=5
      infell(4)=5
      infell(6)=5
      infell(9)=30
      GOTO 300
C  Element IC15
 78   infell(2)=12
      infell(3)=12
      infell(4)=12
      infell(6)=12
      infell(9)=45
      GOTO 300
C  Element TRIP
 79   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) THEN
        infell(2)=7
        infell(4)=7
        infell(6)=7
      ELSE
        infell(2)=4
        infell(4)=4
        infell(6)=4
      ENDIF
      infell(3)=7
      infell(8)=9
      infell(9)=15
      IF (IFOUR.EQ.-3.OR.IFOUR.EQ.1) infell(9)=21
      GOTO 300
C  Element QUAP
 80   infell(2)=9
      infell(3)=9
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=9
      infell(4)=9
      infell(6)=9
C**   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=16
      infell(8)=12
      infell(9)=20
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(9)=28
      GOTO 300
C  Element CUBP
 81   infell(2)=27
      infell(3)=27
      infell(4)=27
      infell(6)=27
      infell(8)=28
      infell(9)=68
      GOTO 300
C  Element TETP
 82   infell(2)=5
      infell(3)=5
      infell(4)=5
      infell(6)=5
      infell(8)=14
      infell(9)=34
      GOTO 300
C  Element PRIP
 83   infell(2)=12
      infell(3)=12
      infell(4)=12
      infell(6)=12
      infell(8)=21
      infell(9)=51
      GOTO 300
C  Element TIMO : Element POUTRE de TIMOSHENCKO
 84   infell(2)=1
      infell(4)=1
      infell(6)=1
      infell(7)=200
      IF (IFOUR.EQ.-3.OR.IFOUR.EQ.-2.OR.IFOUR.EQ.-1) THEN
C  Element TIMO 2D plan
        infell(5)=6
        infell(9)=6
        infell(10)=3
        infell(15)=3
        infell(16)=3
      ELSE
C  Element TIMO 3D
        infell(5)=12
        infell(9)=12
        infell(10)=6
        infell(15)=6
        infell(16)=6
      ENDIF
      GOTO 300
C  Element JOI2
 85   infell(2)=4
      infell(3)=2
      infell(4)=2
      infell(5)=0
      infell(6)=2
      infell(7)=300
      infell(9)=8
      GOTO 300
C  Element JOI3
 86   infell(2)=3
      infell(3)=2
      infell(4)=3
      infell(5)=0
      infell(6)=3
      infell(7)=100
      infell(9)=12
      GOTO 300
C  Element JOT3
 87   infell(2)=3
      infell(3)=3
      infell(4)=3
      infell(5)=0
      infell(6)=3
      infell(7)=100
      infell(9)=18
      GOTO 300
C  Element JOI4
 88   infell(2)=4
      infell(3)=4
      infell(4)=4
      infell(5)=0
      infell(6)=4
      infell(7)=100
      infell(9)=24
      GOTO 300
C  Element JOI6
 89   infell(2)=5
      infell(4)=5
      infell(6)=4
      infell(9)=36
      GOTO 300
C  Element JOI8
 90   infell(2)=9
      infell(4)=9
      infell(6)=9
      infell(9)=48
      GOTO 300
C  Element LINE SPRING LISC
 91   infell(2)=3
      infell(4)=3
      infell(5)=5
      infell(6)=5
      infell(7)=100
      infell(9)=36
      infell(10)=2
      infell(15)=6
      infell(16)=6
      GOTO 300
C  Element TRIH
 92   infell(2)=4
      infell(6)=4
      infell(7)= 0
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.0) THEN
        infell(3)=7
        infell(5)=5
        IF (IFOUR.EQ.0) infell(9)=12
        IF (IFOUR.EQ.1) infell(9)=18
        infell(15)=6
      ELSE
        infell(3)=4
        infell(5)=5
        infell(9)=12
        infell(15)=4
      ENDIF
      GOTO 300
C  Element DST
 93   infell(2)=3
      infell(3)=3
      infell(4)=3
      infell(5)=3
      infell(6)=3
      infell(7)=600
      infell(9)=18
      infell(10)=8
      infell(15)=6
      infell(16)=8
      GOTO 300
C  Element LIC4 : Element de RACCORD LIQUIDE-COQUE a 8 noeuds en 3D
 94   infell(2)=4
      infell(3)=4
      infell(4)=4
      infell(5)=3
      infell(6)=4
      infell(9)=32
      infell(15)=6
      GOTO 300
C  Element CERCE
 95   infell(2)=1
      infell(3)=1
      infell(4)=1
      infell(5)=1
      infell(6)=1
      infell(7)=50
      infell(9)=2
      IF (IFOUR.EQ.1) infell(9)=3
      infell(10)=1
      infell(15)=2
      IF (IFOUR.EQ.1) infell(15)=3
      infell(16)=1
      GOTO 300
C  Element TUYO
 96   NTETA=40
      infell(2)=2*NTETA
      infell(3)=2*NTETA
      infell(4)=2*NTETA
      infell(5)=7
      infell(6)=2*NTETA
      infell(7)=500
      infell(8)=2+4
      infell(9)=12+2*9
      infell(10)=6
      infell(15)=6+9
      infell(16)=6
      GOTO 300
C  Element LSE2 : TUYAU ACOUSTIQUE PURE
 97   infell(2)=2
      infell(3)=2
      infell(4)=2
      infell(5)=7
      infell(6)=2
      infell(7)=200
      infell(9)=4
      infell(10)=2
      infell(15)=2
      infell(16)=2
      GOTO 300
C  Element LITU : COUPLAGE LIQUIDE TUYAU
 98   infell(2)=2
      infell(3)=2
      infell(4)=2
      infell(5)=6
      infell(6)=2
      infell(7)=200
      infell(9)=10
      infell(10)=2
      infell(15)=5
      infell(16)=5
      GOTO 300
C  Element HYT3 : Element HYBRIDE TRI3
 99   infell(3)=4
      infell(6)=4
      GOTO 300
C  Element HYQ4 : Element HYBRIDE QUA4
 100  infell(3)=4
      infell(6)=4
      GOTO 300
C  Element HYBRIDE TET4
 101  infell(3)=4
      infell(6)=4
      GOTO 300
C  Element HYBRIDE PRI6
 102  infell(3)=6
      infell(6)=6
      GOTO 300
C  Element HYBRIDE CUB8
 103  infell(3)=8
      infell(6)=8
      GOTO 300
C  Element TRIS (TRI3-SECTION)
 104  infell(2)=4
      infell(3)=4
      infell(4)=4
      infell(5)=2
      infell(6)=4
      IF (IFOUR.EQ.-2.OR.IFOUR.EQ.-1.OR.IFOUR.EQ.-3) THEN
        infell(10)=2
        infell(16)=2
      ELSE IF (IFOUR.EQ.2) THEN
        infell(10)=3
        infell(16)=3
      ENDIF
      GOTO 300
C  Element QUAS (QUA4-SECTION)
 105  infell(2)=4
      infell(3)=4
      infell(4)=4
      infell(5)=2
      infell(6)=4
      IF (IFOUR.EQ.-2.OR.IFOUR.EQ.-1.OR.IFOUR.EQ.-3) THEN
        infell(10)=2
        infell(16)=2
      ELSE IF (IFOUR.EQ.2) THEN
        infell(10)=3
        infell(16)=3
      ENDIF
      GOTO 300
C  Element POIS (POI1-SECTION)
 106  infell(2)=1
      infell(3)=1
      infell(4)=1
      infell(5)=1
CMILL????  infell(5)=3
      infell(6)=1
      infell(10)=1
      infell(16)=1
      GOTO 300
C  Element JOP3 : JOINTS POREUX
 108  infell(2)=3
      infell(3)=3
      infell(4)=3
      infell(6)=3
      infell(8)=12
      infell(9)=18
      infell(10)=2
      infell(15)=3
      infell(16)=3
      GOTO 300
C  Element JOP6 : JOINTS POREUX
 109  infell(2)=7
      infell(3)=7
      infell(4)=7
      infell(6)=7
      infell(8)=21
      infell(9)=45
      infell(10)=3
      infell(15)=4
      infell(16)=4
      GOTO 300
C  Element JOP8 : JOINTS POREUX
 110  infell(2)=9
      infell(3)=9
      infell(4)=9
      infell(6)=9
      infell(8)=28
      infell(9)=60
      infell(10)=3
      infell(15)=4
      infell(16)=4
      GOTO 300
C  Elements POLYGONE a N cotes
 111  NBSH=infell(8)
      infell(2)=NBSH
      infell(3)=NBSH
      infell(4)=NBSH
      infell(6)=NBSH
      infell(9)=2*NBSH
      IF (IFOUR.EQ.1) infell(9)=3*NBSH
      IF (IFOUR.EQ.-3) infell(9)=2*NBSH+3
      GOTO 300
C  Element BAR3 (barre a 3 noeuds)
 123  NPOINT=3
      infell(2)=NPOINT
      infell(4)=NPOINT
      infell(5)=1
      infell(6)=NPOINT
      infell(7)=200
      infell(9)=9
      IF (IFOUR.EQ.-1.OR.IFOUR.EQ.-2.OR.IFOUR.EQ.0) infell(9)=6
      infell(10)=1
      infell(15)=3
      IF (IFOUR.EQ.-1.OR.IFOUR.EQ.-2.OR.IFOUR.EQ.0) infell(15)=2
      infell(16)=1
      GOTO 300
C  Element BAEX (barre excentree 3D a 2 noeuds)
 124  infell(2)=2
      infell(3)=2
      infell(4)=2
      infell(5)=6
      infell(6)=2
      infell(7)=700
      infell(9)=12
      infell(10)=1
      infell(15)=6
      infell(16)=1
      GOTO 300
C  Element LIA2 : element de liaison a 2 noeuds (6 ddl par noeuds)
 125  infell(2)=2
      infell(4)=2
      infell(5)=9
      infell(6)=2
      infell(7)=200
      infell(9)=12
      infell(10)=6
      infell(15)=6
      infell(16)=6
      GOTO 300
C  Element QUAH
 126  infell(2)=4
      infell(3)=4
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=9
      infell(5)=5
      infell(6)=4
      infell(7)=0
      IF (IFOUR.EQ.0) infell(9)=16
      IF (IFOUR.EQ.1) infell(9)=24
      infell(15)=6
      GOTO 300
C  Element CUBH
 127  infell(2)=8
      infell(3)=27
      infell(5)=5
      infell(6)=27
      infell(7)=0
      infell(9)=48
      infell(15)=6
      GOTO 300
C  Element ROT3 (1 pt GAUSS pr MASSE, 7 pts GAUSS pr RIGIDITE)
 128  infell(3)=1
      infell(6)=7
      infell(9)=3
      infell(15)=1
      GOTO 300
C  Element TR6H
 157  infell(2)=4
      infell(6)=6
      infell(7)=0
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.0) THEN
        infell(3)=7
        infell(5)=5
        IF (IFOUR.EQ.0) infell(9)=12
        IF (IFOUR.EQ.1) infell(9)=18
        infell(15)=6
      ELSE
        infell(3)=6
        infell(5)=5
        infell(9)=24
        infell(15)=4
      ENDIF
      GOTO 300
C  Element SEGS (SEG2-SECTION 2D)
 166  infell(2)=2
      infell(3)=2
      infell(4)=2
      infell(5)=3
      infell(6)=2
      IF (IFOUR.EQ.-2.OR.IFOUR.EQ.-1.OR.IFOUR.EQ.-3) THEN
        infell(10)=2
        infell(16)=2
      ELSE IF (IFOUR.EQ.2) THEN
        infell(10)=3
        infell(16)=3
      ENDIF
      GOTO 300
C  Element POJS (POI1-SECTION)
 167  infell(2)=1
      infell(3)=1
      infell(4)=1
      infell(5)=3
      infell(6)=1
      IF (IFOUR.EQ.-2.OR.IFOUR.EQ.-1.OR.IFOUR.EQ.-3) THEN
        infell(10)=2
        infell(16)=2
      ELSE IF (IFOUR.EQ.2) THEN
        infell(10)=3
        infell(16)=3
      ENDIF
      GOTO 300
C  Element JCT3
 168  infell(2)=3
      infell(3)=3
      infell(4)=3
      infell(6)=3
      GOTO 300
C  Element JCI4
 169  infell(2)=4
      infell(3)=4
      infell(4)=4
      infell(6)=4
      GOTO 300
C  Element JGI2
 170  infell(2)=4
      infell(3)=2
      infell(4)=2
      infell(6)=2
      IF (IFOUR.EQ.-3) infell(9)=infell(9)+3
      infell(15)=2
      GOTO 300
C  Element JGT3
 171  infell(2)=3
      infell(3)=3
      infell(4)=3
      infell(6)=3
      GOTO 300
C  Element JGI4
 172  infell(2)=4
      infell(3)=4
      infell(4)=4
      infell(6)=4
      GOTO 300
C  Element TRIQ
 173  infell(3)=7
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) THEN
        infell(2)=7
        infell(4)=7
        infell(6)=7
      ELSE
        infell(2)=4
        infell(4)=4
        infell(6)=4
      ENDIF
      infell(8)=9
      infell(9)=18
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(9)=24
      GOTO 300
C  Element QUAQ
 174  infell(2)=9
      infell(3)=9
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=9
      infell(4)=9
      infell(6)=9
C**   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=16
      infell(8)=12
      infell(9)=24
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(9)=32
      GOTO 300
C  Element CUBQ
 175  infell(2)=27
      infell(3)=27
      infell(4)=27
      infell(6)=27
      infell(8)=28
      infell(9)=76
      GOTO 300
C  Element TETQ
 176  infell(2)=5
      infell(3)=5
      infell(4)=5
      infell(6)=5
      infell(8)=14
      infell(9)=38
      GOTO 300
C  Element PRIQ
 177  infell(2)=12
      infell(3)=12
      infell(4)=12
      infell(6)=12
      infell(8)=21
      infell(9)=57
      GOTO 300
C  Element TRIR
 178  IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) THEN
        infell(2)=7
        infell(6)=7
        infell(4)=7
      ELSE
        infell(2)=4
        infell(4)=4
        infell(6)=4
      ENDIF
      infell(3)=7
      infell(8)=9
      infell(9)=21
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(9)=27
      GOTO 300
C  Element QUAR
 179  infell(2)=9
      infell(3)=9
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=9
      infell(4)=9
      infell(6)=9
C**   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=16
      infell(8)=12
      infell(9)=28
      IF (IFOUR.EQ.1.OR.IFOUR.EQ.-3) infell(9)=36
      GOTO 300
C  Element CUBR
 180  infell(2)=27
      infell(3)=27
      infell(4)=27
      infell(6)=27
      infell(8)=28
      infell(9)=84
      GOTO 300
C  Element TETR
 181  infell(2)=5
      infell(3)=5
      infell(4)=5
      infell(6)=5
      infell(8)=14
      infell(9)=42
      GOTO 300
C  Element PRIR
 182  infell(2)=12
      infell(3)=12
      infell(4)=12
      infell(6)=12
      infell(8)=21
      infell(9)=61
      GOTO 300
C  Element Q4RI (QUA4 with 1x1 Gauss points)
 183  infell(2)=4
      infell(3)=1
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=9
      infell(4)=1
C**   infell(4)=5    CORRECTION  MILL  LE 8/8/90
      infell(6)=1
C**   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=9
      infell(9)=8
      IF (IFOUR.EQ.-3) infell(9)=11
      IF (IFOUR.EQ.1) infell(9)=12
      GOTO 300
C  Element Q8RI (QUA8 with 2x2 Gauss points)
 184  infell(2)=9
      infell(3)=4
      IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(3)=16
      infell(4)=4
      infell(6)=4
C**   IF (IFOUR.EQ.0.OR.IFOUR.EQ.1) infell(6)=16
      infell(9)=16
      IF (IFOUR.EQ.-3) infell(9)=19
      IF (IFOUR.EQ.1) infell(9)=24
      GOTO 300
C  Element JOQ3
 185  infell(2)=3
      infell(3)=3
      infell(4)=3
      infell(6)=3
      infell(8)=12
      infell(9)=24
      infell(10)=4
      infell(15)=4
      infell(16)=4
      GOTO 300
C  Element JOQ6
 186  infell(2)=7
      infell(3)=7
      infell(4)=7
      infell(6)=7
      infell(8)=21
      infell(9)=54
      infell(10)=5
      infell(15)=5
      infell(16)=5
      GOTO 300
C  Element JOQ8
 187  infell(2)=9
      infell(3)=9
      infell(4)=9
      infell(6)=9
      infell(8)=28
      infell(9)=72
      infell(10)=5
      infell(15)=5
      infell(16)=5
      GOTO 300
C  Element JOR3
 188  infell(2)=3
      infell(3)=3
      infell(4)=3
      infell(6)=3
      infell(8)=12
      infell(9)=30
      infell(10)=5
      infell(15)=5
      infell(16)=5
      GOTO 300
C  Element JOR6
 189  infell(2)=7
      infell(3)=7
      infell(4)=7
      infell(6)=7
      infell(8)=21
      infell(9)=63
      infell(10)=6
      infell(15)=6
      infell(16)=6
      GOTO 300
C  Element JOR8
 190  infell(2)=9
      infell(3)=9
      infell(4)=9
      infell(6)=9
      infell(8)=28
      infell(9)=84
      infell(10)=6
      infell(15)=6
      infell(16)=6
      GOTO 300
C  Element T1D2/M1D2 : Element THERMIQUE/MECANIQUE MASSIF 1D a 2 noeuds
C  On suppose que IFOMOD= 3 ou 4 ou 5 (IDIM=1)
 191  infell(2)=2
      infell(3)=2
      infell(4)=2
      infell(6)=2
      infell(9)=2
      IF ((IFOUR.GE.7.AND.IFOUR.LE.10).OR.IFOUR.EQ.14) infell(9)=3
      IF (IFOUR.EQ.11) infell(9)=4
      GOTO 300
C  Element T1D3/M1D3 : Element THERMIQUE/MECANIQUE MASSIF 1D a 3 noeuds
C  On suppose que IFOMOD= 3 ou 4 ou 5 (IDIM=1)
 192  infell(2)=3
      infell(3)=3
      infell(4)=3
      infell(6)=3
      infell(9)=3
      IF ((IFOUR.GE.7.AND.IFOUR.LE.10).OR.IFOUR.EQ.14) infell(9)=4
      IF (IFOUR.EQ.11) infell(9)=5
      GOTO 300
C  Element fluide NAVIER_STOKES
C  LC03 LS03 BS03
 195  infell(6)=2
      GOTO 300
C  LC07 LS07 BS07
 196  infell(6)=7
      GOTO 300
C  LC09 LS09 BS09
 197  infell(6)=4
      GOTO 300
C  MC03
 216  infell(6)=2
      GOTO 300
C  MC07
 217  infell(6)=7
      GOTO 300
C  MC09
 218  infell(6)=4
      GOTO 300
C  M103 MS03
 223  infell(6)=3
      GOTO 300
C  M107 MS07
 224  infell(6)=7
      GOTO 300
C  M109 MS09
 225  infell(6)=16
      GOTO 300
C  QC03 Q103 QS03
 237  infell(6)=3
      GOTO 300
C  QC07 Q107 QS07
 238  infell(6)=7
      GOTO 300
C  QC09 Q109 QS09
 239  infell(6)=16
      GOTO 300
C
C     CIFL
C
 258  CONTINUE
      infell(2)=1
      infell(3)=1
      infell(4)=1
      infell(6)=1
      infell(8)=0
      infell(9)=8
      infell(10)=5
      infell(15)=3
      infell(16)=5
      GO TO 300
C
C     SHB8
C
 260  CONTINUE
      infell(2)=5
      infell(3)=5
      infell(4)=5
      infell(6)=5
      infell(8)=0
      infell(9)=24
      infell(10)=6
      infell(13)= 1
      infell(15)=3
      infell(16)=6
      GO TO 300
C
C   XQ4R
C
 263  INFELl(2)=0
      INFELl(3)=64
      INFELl(4)=64
      INFELl(6)=64
      INFELl(15)=20
      INFELl(16)=4
      INFELl(9) = 4*INFELl(15)
      INFELl(10)=4
      GOTO 300
C
C   XC8R
C
 264  INFELl(2)=0
      INFELl(3)=64
      INFELl(4)=64
      INFELl(6)=64
      INFELl(15)=30
      INFELl(16)=6
      INFELl(9) = 8*INFELl(15)
      INFELl(10)=6
      GOTO 300
C
C  Element JOI1 : element de liaison a 2 noeuds (6 ddl par noeuds)
C
 265  infell(2)=1
      infell(3)=1
      infell(4)=1
      infell(5)=0
      infell(6)=1
      infell(7)=700
      infell(8)=0
      infell(13)=75
      infell(14)=2
      IF(IFOUR.EQ.2) THEN
          infell(9)=12
          infell(10)=6
          infell(15)=6
          infell(16)=6
      ELSE IF(IFOUR.EQ.-2.OR.IFOUR.EQ.-1) THEN
          infell(9)=6
          infell(10)=3
          infell(15)=3
          infell(16)=3
      ENDIF
      GOTO 300
C
C  Element ZCO2 : zone cohesive a 2 noeuds (2 ddls par noeud)
C
 266  infell(2)=2
      infell(4)=2
      infell(6)=2
      infell(7)=100
      infell(9)=4
      infell(10)=2
      infell(15)=2
      infell(16)=2
      GOTO 300
C
C  Element ZCO3 : zone cohesive a 3 noeuds (2 ddls par noeud)
C
 267  infell(2)=1
      infell(4)=1
      infell(6)=1
      infell(7)=100
      infell(9)=9
      infell(10)=3
      infell(15)=3
      infell(16)=3
      GOTO 300
C
C  Element ZCO4 : zone cohesive a 4 noeuds (2 ddls par noeud)
C
 268  infell(2)=4
      infell(4)=4
      infell(6)=4
      infell(7)=100
      infell(9)=12
      infell(10)=3
      infell(15)=3
      infell(16)=3
      GOTO 300
c
C  Element TUY2 : tuyau pour modele d'advection en thermique
C
 269  infell(2)=2
      infell(4)=2
      infell(5)=5
      infell(6)=2
      infell(7)=200
      infell(9)=2
      infell(10)=1
      infell(15)=1
      infell(16)=1
      GOTO 300
c
C  Element TUY3 : tuyau pour modele d'advection en thermique
C
 270  infell(2)=3
      infell(4)=3
      infell(5)=5
      infell(6)=3
      infell(7)=200
      infell(9)=2
      infell(10)=1
      infell(15)=1
      infell(16)=1
      GOTO 300
c
c    element coaxial COS2 (3D pour liaison acier-beton)
c
 271  infell(2)=1
      infell(4)=2
      infell(5)=2
      infell(6)=2
      infell(7)=100
      infell(9)=4*idim
      infell(10)=3
      infell(14)=12
      infell(15)=IDIM
      infell(16)=3
c
c    element coaxial COA2 (3D pour liaison acier-beton)
c
 272  infell(2)=1
      infell(4)=2
      infell(5)=2
      infell(6)=2
      infell(7)=100
      infell(9)=4*idim
      infell(10)=3
      infell(14)=12
      infell(15)=IDIM
      infell(16)=3
C
 300  IF (IELE.EQ.0) IELE=infell(14)
      NBGST = infell(4)
      NBG = infell(6)
      NBGM = infell(3)
      IF (NBGM.EQ.0) THEN
        NBGM=NBG
        infell(3)=NBGM
      ENDIF
      NBSH = NBNNE(IELE)
      IF (MELE.GE.79.AND.MELE.LE.83 ) NBSH = infell(8)
      IF (MELE.EQ.96) NBSH = infell(8)
      IF (MELE.GE.108.AND.MELE.LE.110) NBSH = infell(8)
      IF (MELE.GE.111.AND.MELE.LE.122) NBSH = infell(8)
      IF (MELE.GE.173.AND.MELE.LE.182) NBSH = infell(8)
      IF (MELE.GE.185.AND.MELE.LE.190) NBSH = infell(8)
      IF (MELE.GE.195.AND.MELE.LE.257) NBSH = infell(8)
      IF (MELE.EQ.263.OR.MELE.EQ.264 ) NBSH = infell(8)

C Cas particulier des formulations massives (mfr2 > 0)
C Ici : infell(9) = 1 * nb.noeuds.EF
      IF (mfr2.NE.0) THEN
        infell(9) = NBSH
      ENDIF
*
* nombre composante contraintes/defo, materiau IMPEDANCE
      if (dcmate) then
         call idprim(IMODEL,MFR3,IPNOMC,NBROBL,NBRFAC)
        if(tymode(/2).gt.0) then
         if (tymode(1).eq.'LISTMOTS') then
          dcmat2 = .true.
          mlmot5 = ivamod(1)
          segact mlmot5
          nbrobl = mlmot5.mots(/2)*2
         endif
        endif
        if (dcmat2.and.mele.eq.2) then
          infell(9) = nbrobl
          infell(10) = nbrobl/2
          infell(15) = nbrobl/2
         infell(16) = nbrobl/2
        else
         infell(15) = nbrobl
          if (nbrfac.gt.0) infell(15) = infell(15) + nbrfac
         infell(16) = infell(15)
         if (mele.eq.45) infell(9) = nbrobl
         if (mele.eq.2) infell(9) = nbrobl*2
        endif
      endif

c*      write(6,*)'TYINTE',TYINTE
c*      write(6,*)'MELE:',MELE,'IELE:',IELE,'NBSH:',NBSH,'NBG:',NBG

C  Remplissage de infell(12) si MFR=5 cad MELE=41 ou 56 (COQ8 ou COQ6)
C  -------------------------
      IF (MFR.EQ.5.OR.MFR.EQ.74) THEN
c*        write(6,*) ' elquoi appel a renoeu '
        CALL RENOEU(IELE,MELE,NBSH,IPT2,IRT2)
c*        write(6,*) ' elquoi sortie  renoeu  ipt2 irt2'  ,ipt2,irt2
        if(inttyp.eq.-10) then
        infmod(8)=IPT2
        else
        infell(12)=ipt2
        endif
      ENDIF
c
c     cas XFEM : le 2nd segment d integration contient le MINTE de l'EF
c  correspondant non enrichi (avec un nombre reduit de point de Gauss)
      IF (MFR.EQ.63) THEN
        if(MELE.eq.263)  then
         MEL2 = 8
         NBG2 = 4
         NBSH2 = 4
        else if(MELE.eq.264)  then
         MEL2 = 14
         NBG2 = 8
         NBSH2 = 8
        endif
c        pour l'instant on ne distingue pas les cas selon TYINTE
         CALL RESHPT(NBG2,NBSH2,IELE,MEL2,0,IPT2,IRT2)
        if(inttyp.eq.-10) then
          infmod(8)=IPT2
        else
          infell(12)=IPT2
        endif
      ENDIF

C  Remplissage de infell(11) : INTEGRATION DE L'ELEMENT FINI
C  ---------------------------
      IDETYI = 0
 400  CONTINUE
      IF (INTTYP.EQ.-10) TYINTE = TYINTE + 1

C Tests de verification :
      IF (MELE.GT.NELFI) THEN
        WRITE(IOIMP,*)
        WRITE(IOIMP,*) 'ELQUOI : incoherence NELFI & MELE ',
     &                 NELFI,MELE
        CALL ERREUR(5)
        RETURN
      ENDIF
      IF (TYINTE.GT.NTYNTE) THEN
        WRITE(IOIMP,*)
        WRITE(IOIMP,*) 'ELQUOI : incoherence TYINTE & NTYNTE',
     &                 TYINTE,NTYNTE
        CALL ERREUR(5)
        RETURN
      ENDIF

C  ==                ===          ======                ===
C  Si le segment n'a pas deja ete rempli ou si c'est un DKT : iin = 0
C  ==                ===          ======                ===
      IF (MELE.EQ.28) THEN
        iin = 0
      ELSE
        iin = INTEGR(MELE,TYINTE,IBMODE)
      ENDIF
C  ==                            ====     ======
C  Si le segment d'integration a deja ete rempli : iin est non nul ici !
C  ==                            ====     ======

      IF (iin.EQ.0) THEN
        IPT1 = 0
C  Cas des elements de MECANIQUE :
C  -------------------------------
C SI FAUX ? Ne devrait-on pas avoir MELE < 57 OU MELE > 68 ?????
        IF (MELE.LT.57.OR.MELE.GT.64) THEN
C  1 = Champ aux noeuds
          IF (TYINTE.EQ.1) THEN
            IF(MELE.GE.195.and.mele.ne.260.and.mele.ne.263.and.
     &         mele.ne.264) THEN
              CALL RESHPT(NBG,NBSH,IELE,MELE,0,IPT1,IRT1)
            ELSE
              CALL RENOEU(IELE,MELE,NBSH,IPT1,IRT1)
            ENDIF
C  2 = Point de Gauss, centre de gravite et champ CONSTANT
          ELSE IF (TYINTE.EQ.2) THEN
            CALL RESHPT(1,NBSH,IELE,MELE,NPINT,IPT1,IRT1)
C  3 = Point de Gauss pour la rigidite
          ELSE IF (TYINTE.EQ.3) THEN
            if(mele.eq.263.or.mele.eq.264) then
              CALL RESHPX(NBG,NBSH,IELE,MELE,NPINT,IPT1,IRT1)
            else
              CALL RESHPT(NBG,NBSH,IELE,MELE,NPINT,IPT1,IRT1)
            endif
C  4 = Point de Gauss pour la masse
          ELSE IF (TYINTE.EQ.4) THEN
            if(mele.eq.263.or.mele.eq.264) then
              CALL RESHPX(NBGM,NBSH,IELE,MELE,NPINT,IPT1,IRT1)
            else
              CALL RESHPT(NBGM,NBSH,IELE,MELE,NPINT,IPT1,IRT1)
            endif
C  5 = Point de Gauss - calcul des contraintes
          ELSE IF (TYINTE.EQ.5) THEN
            if(mele.eq.263.or.mele.eq.264) then
              CALL RESHPX(NBG,NBSH,IELE,MELE,NPINT,IPT1,IRT1)
            else
              CALL RESHPT(NBGST,NBSH,IELE,MELE,NPINT,IPT1,IRT1)
            endif
C  6 = Pas de segment d'integration
          ELSE IF (TYINTE.EQ.6) THEN
            IPT1 = 0
C  7 = Champ aux faces
C  8 = Champ aux CENTREP1
          ELSE IF (TYINTE.EQ.8) THEN
            CALL RESHPT(NBG,NBSH,IELE,MELE,1,IPT1,IRT1)
C  9 = Champ aux MSOMMET
          ELSE IF (TYINTE.EQ.9) THEN
            CALL RESHPT(NBG,NBSH,IELE,MELE,2,IPT1,IRT1)
C  Autre cas =  Point de Gauss pour la rigidite
          ELSE
            CALL RESHPT(NBG,NBSH,IELE,MELE,NPINT,IPT1,IRT1)
          ENDIF
C  Cas des elements de THERMIQUE :
C  -------------------------------
C       ELSE
C         CALL TINTR(MELE,IPT1)
        ENDIF
        IF (IPT1.NE.0) CALL SAVSEG(IPT1)
        iin = IPT1
        INTEGR(MELE,TYINTE,IBMODE) = iin
      ENDIF

      IF (INTTYP.EQ.-10) THEN
        imodel.infmod(2+TYINTE+IDETYI) = iin
        IF (TYINTE.LT.5) GOTO 400
        IF (TYINTE.EQ.5.AND.IDETYI.EQ.0) THEN
          IF (mele.EQ.263) THEN
* pour le XQ4R on recommence pour avoir les fonctions de forme
* classiques du : qua4
            TYINTE = 0
            IDETYI = 5
            mele  = 8
            nbsh  = 4
            nbg   = 4
            nbgm  = 4
            nbgst = 4
            GOTO 400
          ELSE IF (mele.EQ.264) THEN
* pour le XC8R on recommence pour avoir les fonctions de forme
* classiques du : cub8
            TYINTE = 0
            IDETYI = 5
            mele  = 14
            nbsh  = 8
            nbg   = 8
            nbgm  = 8
            nbgst = 8
            GOTO 400
          ENDIF
        ENDIF
      ENDIF

      infell(11) = iin

C Sortie de ELQUOI : le segment IPTR=INFO est ACTIF.
      IPTR = INFO
c*      write(6,*)'-> ELQUOI infell',(infell(iou),iou=1,16)

      RETURN
      END




