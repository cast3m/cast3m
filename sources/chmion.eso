C CHMION    SOURCE    CHAT      05/01/12    21:59:14     5004
      SUBROUTINE CHMION(IDSCHI,SP2,XMUNEW)
C=======================================================================
C            ISSU DE TRIO-EF (TRICAL)
C
C - OBJET: CALCUL DE FORCE IONIQUE
C
C - ARGUMENTS: POINTEURS DES SEGMENTS IDSCHI SP2
C              XMUNEW = NOUVELLE FORCE IONIQUE
C
C - METHODES: CALCULE LA FORCE IONIQUE D'APRES LES CHARGES DES COMPOSANTS
C ET LES VALEURS DE CONCENTRATIONS "C" DES ESPECES DISSOUTES DE TYPE I ET
C II
C
C PEUT ETRE UTILISE POUR AFFINER LA CORRECTION DES LOGK AU SEIN D'UNE
C BOUCLE, EN FONCTION D'UN CRITERE:
C
C               10 CALL CHMKMD()
C                  ...
C                  CALL CHMION()
C                  ...CRITERE DE SORTIE DE BOUCLE
C                  GOTO 10
C
C======================================================================
      IMPLICIT INTEGER(I-N)
      IMPLICIT REAL*8(A-H,O-Z)
      SEGMENT IDSCHI
           REAL*8 GK(NYDIM),AA(NYDIM,NXDIM),FF(NZDIM,NPDIM)
           INTEGER IDX(NXDIM),IDY(NYDIM),IDZ(NZDIM),IDP(NPDIM),NN(6)
           INTEGER IDECY(NYDIM),IONZ(NXDIM)
           CHARACTER*32 NAME(NXDIM),NAMESP(NYDIM)
      ENDSEGMENT
      SEGMENT SP2
           REAL*8 GX(NXDIM),XX(NXDIM),GS(NZDIM),SS(NZDIM)
           REAL*8 TOT(NXDIM),TOTAQ(NXDIM),TOTFIX(NXDIM),GKS(NZDIM)
           REAL*8 YY(NXDIM),ZZ(NXDIM,NXDIM),CC(NYDIM),GC(NYDIM)
      ENDSEGMENT
C
      I1=NN(1)+1
      I2=NN(1)+NN(2)
      NXDIM=IDX(/1)
      XMUNEW=0.D0
      DO 50 I=I1,I2
      VI=0.D0
      DO 51 J=1,NXDIM
      VI=VI+AA(I,J)*IONZ(J)
51    CONTINUE
      XMUNEW=XMUNEW+VI*VI*CC(I)
50    CONTINUE

*
* SEULES LES ESPECES DE TYPE 1 PARTICIPENT A LA FORCE IONIQUE
* L'ESPECE SIMPLE D'UN COMPOSANT MIS EN TYPE 6 N'INTERVIENT PAS
* (CF ELECTRON ,SITE DE SURFACE
      DO 54 J=1,NN(1)
      IDYJ=IDY(J)
      CALL CHIADY(IDX,NXDIM,IDYJ,IYJ)
      VI=IONZ( IYJ)*IONZ( IYJ)
      XMUNEW=XMUNEW+VI*ABS(CC(J))
 54   CONTINUE
      XMUNEW=XMUNEW/2.D0
      RETURN
      END
C
C
C
C




